{"ast":null,"code":"import _objectSpread from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import FuseAnimate from'@fuse/core/FuseAnimate';import FuseChipSelect from'@fuse/core/FuseChipSelect';import FuseLoading from'@fuse/core/FuseLoading';import FusePageCarded from'@fuse/core/FusePageCarded';import{useForm}from'@fuse/hooks';import _ from'@lodash';import{Button,Icon,TextField,Typography}from'@material-ui/core';import{useTheme}from'@material-ui/core/styles';import JwtService from'app/services/jwtService';import React,{useEffect,useState,useContext}from'react';import{Link,useHistory}from'react-router-dom';import fileUpload from'fuctbase64';import{SnackbarContext}from'app/context/SnackbarContext';import VendorSearch from'../common/VendorSearch';var premiumKey={message:'',image:'',title:'',city_id:{},city_name:'',linktype:'url',link:''};function GlobalNotification(_ref){var props=_ref.props;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),cities=_useState4[0],setCities=_useState4[1];var _useState5=useState('url'),_useState6=_slicedToArray(_useState5,2),linkType=_useState6[0],setLinkType=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),errors=_useState8[0],setError=_useState8[1];var theme=useTheme();var _useForm=useForm(premiumKey),form=_useForm.form,handleChange=_useForm.handleChange,setForm=_useForm.setForm;var history=useHistory();var axios=JwtService.getAxios();var context=useContext(SnackbarContext);useEffect(function(){if(cities.length>0)setLoading(false);setLinkType(premiumKey.linktype);},[cities]);useEffect(function(){var getData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:try{axios.get('/api/admin/city').then(function(res){var data=res.data.data;setCities(data.cities);});}catch(error){console.log('error');setLoading(false);}case 1:case\"end\":return _context.stop();}}},_callee);}));return function getData(){return _ref2.apply(this,arguments);};}();getData();// eslint-disable-next-line\n},[]);function handleChipChange(value,name){if(name==='linktype'){console.log(value);setLinkType(value.value);setForm(_.set(_objectSpread({},form),name,value.value));console.log(linkType);}else setForm(_.set(_objectSpread({},form),name,value));}function headerUpload(files){fileUpload(files).then(function(data){setForm(_.set(_objectSpread({},form),\"image\",\"data:\".concat(data.type,\";base64,\").concat(data.base64)));});}function setVendor(value){setForm(_.set(_objectSpread({},form),'link',value));}function canBeSubmitted(){return form.message.length>0&&form.title.length>0&&Object.keys(form.city_id).length===2;}function onSubmit(){return _onSubmit.apply(this,arguments);}function _onSubmit(){_onSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var params,result,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setLoading(true);params={message:form.message,title:form.title,city_id:form.city_id.value,city_name:form.city_id.label,linktype:form.linktype,link:form.link};if(form.image){params['image']=form.image;}_context2.next=6;return axios.post('/api/admin/send-global-notification',params);case 6:result=_context2.sent;console.log(result);res=result.data;if(!res.status){setLoading(false);context.setMessage(res.message);context.setSeverity('error');context.setOpen(true);}else{history.push('/global-notifications');}_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,12]]);}));return _onSubmit.apply(this,arguments);}if(loading){return/*#__PURE__*/React.createElement(FuseLoading,null);}return/*#__PURE__*/React.createElement(FusePageCarded,{classes:{toolbar:'p-0',header:'min-h-72 h-72 sm:h-136 sm:min-h-136'},header:form&&/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-1 w-full items-center justify-between\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-col items-start max-w-full\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{className:\"normal-case flex items-center sm:mb-12\",component:Link,role:\"button\",to:\"/\",color:\"inherit\"},/*#__PURE__*/React.createElement(Icon,{className:\"text-20\"},theme.direction==='ltr'?'arrow_back':'arrow_forward'),/*#__PURE__*/React.createElement(\"span\",{className:\"mx-4\"},\"Send Global Notification\")))),/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Button,{className:\"whitespace-no-wrap normal-case\",variant:\"contained\",color:\"secondary\",disabled:!canBeSubmitted(),onClick:onSubmit},'Submit'))),content:form&&/*#__PURE__*/React.createElement(\"div\",{className:\"p-16 sm:p-24 max-w-2xl\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"title\",name:\"title\",onChange:handleChange,label:\"Title Of Notification\",value:form.title,variant:\"outlined\",fullWidth:true,required:true}),/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"message\",name:\"message\",onChange:handleChange,label:\"Message\",value:form.message,variant:\"outlined\",fullWidth:true,required:true}),/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"image\",name:\"image\",onChange:headerUpload,label:\"Image\",type:\"file\",variant:\"outlined\",fullWidth:true,required:true}),/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:form.city_id,onChange:function onChange(value){return handleChipChange(value,'city_id');},textFieldProps:{label:'City',InputLabelProps:{shrink:true},variant:'outlined'},options:cities.map(function(city){return{value:city.id,label:city.name};}),required:true}),/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.linktype.value?form.linktype.value:form.linktype,label:form.linktype.label?form.linktype.label:form.linktype.toUpperCase()},onChange:function onChange(value){return handleChipChange(value,'linktype');},textFieldProps:{label:'link Type',InputLabelProps:{shrink:true},variant:'outlined'},options:[{value:'vendor',label:'Vendor'},{value:'url',label:'URL'}],error:errors['linktype'],helperText:errors['linktype']?errors['linktype'][0]:''}),linkType==='vendor'?/*#__PURE__*/React.createElement(VendorSearch,{setValue:setVendor,selectedVendor:(form===null||form===void 0?void 0:form.vendor)||null,error:errors['link']}):/*#__PURE__*/React.createElement(React.Fragment,null),linkType==='url'?/*#__PURE__*/React.createElement(TextField,{autoFocus:true,margin:\"dense\",className:\"mt-8 mb-8\",id:\"link\",name:\"link\",label:\"Link\",type:\"text\",fullWidth:true,value:form.link,onChange:handleChange,variant:\"outlined\",error:errors['link']?true:false,helperText:errors['link']?errors['link'][0]:null}):/*#__PURE__*/React.createElement(React.Fragment,null)))});}export default GlobalNotification;","map":null,"metadata":{},"sourceType":"module"}