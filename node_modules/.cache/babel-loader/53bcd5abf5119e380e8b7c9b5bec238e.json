{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import JwtService from'app/services/jwtService';import{Grid}from'@material-ui/core';import MaterialTable from'material-table';import{useHistory}from'react-router';import FusePageSimple from'@fuse/core/FusePageSimple';import FuseLoading from'@fuse/core/FuseLoading';import{connect}from'react-redux';import axios from'axios';function Vendors(_ref){var user=_ref.user;var history=useHistory();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),selectedOption=_useState2[0],setSelectedOption=_useState2[1];// Initial selected option\nvar _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),alldata=_useState4[0],setAlldata=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),data=_useState6[0],setData=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),page=_useState8[0],setPage=_useState8[1];var _useState9=useState(10),_useState10=_slicedToArray(_useState9,2),pageSize=_useState10[0],setPageSize=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),search=_useState12[0],setSearch=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),totalCount=_useState14[0],setTotalCount=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),loading=_useState16[0],setLoading=_useState16[1];function getData(){return new Promise(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(resolve){var axios,params,vendors,resp,allparams,allvendors,allresp;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:JwtService.init();axios=JwtService.getAxios();params={page:page,limit:pageSize,q:search};if(user.data.role==='vendor')params.parent_id=user.data.xid;else params.parent_id=0;_context.next=6;return axios.get('/api/admin/vendor',{params:params});case 6:vendors=_context.sent;resp=vendors.data;if(!(alldata=='')){_context.next=15;break;}allparams={limit:resp.data.total,q:'',parent_id:0};_context.next=12;return axios.get('/api/admin/vendor?limit='+resp.data.total+'&q=&parent_id=0');case 12:allvendors=_context.sent;allresp=allvendors.data;setAlldata(allresp.data.data);case 15:if(resp.status){resolve({data:resp.data.data,/// your data array\npage:pageSize,// current page number\ntotalCount:resp.data.total// total row number\n});}else{resolve({data:[],/// your data array\npage:0,// current page number\ntotalCount:0// total row number\n});}case 16:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());}var fetchData=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setLoading(true);_context2.next=4;return getData();case 4:result=_context2.sent;// console.log(result.totalCount)\nsetData(result.data);setTotalCount(result.totalCount);// setPage(result.page);\n_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);console.error('Error fetching data:',_context2.t0);case 12:_context2.prev=12;setLoading(false);return _context2.finish(12);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9,12,15]]);}));return function fetchData(){return _ref3.apply(this,arguments);};}();useEffect(function(){// Define a function to fetch data\nfetchData();// Call the fetchData function when selectedOption changes\n},[selectedOption,page,pageSize]);//console.log(data)\nfunction actions(){var actions=[];if(['admin','it','creative','alliance'].includes(user.data.role)){actions.push({icon:'visibility',tooltip:'View Vendor',onClick:function onClick(event,data){return history.push('/vendor/'+data.id+\"/about\");}});}return actions;}var handleOnChange=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var selectedOption,attributeValue,value,res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:selectedOption=e.target.options[e.target.selectedIndex];attributeValue=selectedOption.getAttribute('row-id');value=e.target.value;_context3.next=5;return axios.put(\"/api/admin/vendor/\".concat(attributeValue,\"?status=\").concat(value));case 5:res=_context3.sent;if(res.data.status){setSelectedOption(function(prevCount){return prevCount+1;});}case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function handleOnChange(_x2){return _ref4.apply(this,arguments);};}();var handlePageChange=function handlePageChange(newPage){setPage(newPage);};var handlePageSizeChange=function handlePageSizeChange(newPageSize){setPageSize(newPageSize);setPage(0);// Reset to the first page when changing page size\n};var handleSearchChange=function handleSearchChange(search){setSearch(search);};if(loading){return/*#__PURE__*/React.createElement(FuseLoading,null);}return/*#__PURE__*/React.createElement(FusePageSimple,{content:/*#__PURE__*/React.createElement(Grid,{container:true},/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(MaterialTable,{title:\"Vendors\"// data={{ data: data, totalCount: totalCount, page: page}}\n,data:data,page:page,totalCount:totalCount,columns:[{title:'Name',field:'name',width:30},{title:'Locality',field:'locality',width:30},{title:'City',field:'city.name',width:10},{title:'Status',field:'status',width:10},{title:'Status',field:'name',width:10,render:function render(data){return/*#__PURE__*/React.createElement(\"select\",{onChange:handleOnChange,id:\"countries\",className:\"bg-gray-50 border border-gray-300 text-gray-900 text-[16px] h-40 rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500\"},/*#__PURE__*/React.createElement(\"option\",{selected:true,disabled:true},\"Choose a Status\"),/*#__PURE__*/React.createElement(\"option\",Object.assign({value:\"active\",\"row-id\":data.id},data.status==='active'?{selected:true}:{}),\"Active\"),/*#__PURE__*/React.createElement(\"option\",Object.assign({value:\"inactive\",\"row-id\":data.id},data.status==='inactive'?{selected:true}:{}),\"In-Active\"));}}],actions:actions(),options:{pageSize:pageSize,pageSizeOptions:[10,20,50],actionsColumnIndex:-1,searchable:true},onChangePage:handlePageChange,onChangeRowsPerPage:handlePageSizeChange// onSearchChange={handleSearchChange}\n,onSearchChange:function onSearchChange(searchText){var filteredData=alldata.filter(function(item){return item.name.toLowerCase().includes(searchText.toLowerCase());});setData(filteredData);}})))});}function mapStateToProps(_ref5){var auth=_ref5.auth;return{user:auth.user};}export default connect(mapStateToProps)(Vendors);","map":null,"metadata":{},"sourceType":"module"}