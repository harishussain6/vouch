{"ast":null,"code":"import _regeneratorRuntime from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"D:\\\\Projects\\\\live\\\\src\\\\app\\\\main\\\\redemption\\\\Redemptions.js\";\nimport React, { useState, useEffect } from 'react';\nimport { Grid, Typography, Paper, TextField, Button } from '@material-ui/core';\nimport FusePageSimple from '@fuse/core/FusePageSimple';\nimport MaterialTable from 'material-table';\nimport JwtService from 'app/services/jwtService';\nimport { connect } from 'react-redux';\nimport Add from './Add';\nimport moment from 'moment-timezone';\n\nfunction Redemption(_ref) {\n  var user = _ref.user;\n\n  var _useState = useState(currentDate()),\n      _useState2 = _slicedToArray(_useState, 2),\n      toDate = _useState2[0],\n      setToDate = _useState2[1];\n\n  var _useState3 = useState(currentDate()),\n      _useState4 = _slicedToArray(_useState3, 2),\n      fromDate = _useState4[0],\n      setFromDate = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      redemptions = _useState6[0],\n      setRedemptions = _useState6[1];\n\n  var _useState7 = useState(true),\n      _useState8 = _slicedToArray(_useState7, 2),\n      loading = _useState8[0],\n      setLoading = _useState8[1];\n\n  var _useState9 = useState(true),\n      _useState10 = _slicedToArray(_useState9, 2),\n      disabled = _useState10[0],\n      setDisabled = _useState10[1];\n\n  function currentDate() {\n    var today = new Date();\n    var dd = String(today.getDate()).padStart(2, '0');\n    var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!\n\n    var yyyy = today.getFullYear();\n    return yyyy + '-' + mm + '-' + dd;\n  }\n\n  useEffect(function () {\n    // eslint-disable-next-line\n    if (loading) setDisabled(false);\n  }, [loading]);\n  useEffect(function () {\n    if (toDate && fromDate) data(); // eslint-disable-next-line\n  }, []); // }, [toDate, fromDate]);\n\n  function onChange(event) {\n    var target = event.target;\n\n    if (target.name === 'toDate') {\n      setToDate(target.value);\n    } else {\n      setFromDate(target.value);\n    }\n  }\n\n  function data() {\n    return _data.apply(this, arguments);\n  }\n\n  function _data() {\n    _data = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var axios, params, vendors, resp;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n              axios = JwtService.getAxios();\n              params = {\n                date_from: fromDate,\n                date_to: toDate\n              };\n              if (user.data.role === 'vendor') params.vendor_id = user.data.xid;\n              _context.next = 6;\n              return axios.get('/api/admin/redemption', {\n                params: params\n              });\n\n            case 6:\n              vendors = _context.sent;\n              resp = vendors.data;\n              setLoading(false);\n              return _context.abrupt(\"return\", setRedemptions(resp.data));\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _data.apply(this, arguments);\n  }\n\n  function Action(props) {\n    switch (props.action.icon) {\n      case 'save':\n        return user.data.role === 'marketing' ? /*#__PURE__*/React.createElement(React.Fragment, null) : /*#__PURE__*/React.createElement(Add, {\n          reload: data,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 66,\n            columnNumber: 53\n          }\n        });\n\n      default:\n        return /*#__PURE__*/React.createElement(React.Fragment, null);\n    }\n  }\n\n  function getColumns() {\n    var column = [{\n      title: 'App Name',\n      field: 'appname'\n    }, {\n      title: 'User Name',\n      field: 'user'\n    }];\n\n    if (user.data.role === 'admin') {\n      column.push({\n        title: 'Email',\n        field: 'email'\n      });\n      column.push({\n        title: 'Savings',\n        field: 'total_savings'\n      });\n    }\n\n    return [].concat(column, [{\n      title: 'Brand',\n      field: 'vendor'\n    }, {\n      title: 'Locality',\n      field: 'locality'\n    }, {\n      title: 'City',\n      field: 'city'\n    }, {\n      title: 'Voucher',\n      field: 'voucher'\n    }, {\n      title: 'Reference Code',\n      field: 'reference_code'\n    }, {\n      title: 'Time',\n      field: 'created_at',\n      render: function render(rowData) {\n        var date = moment(rowData.created_at).tz('Asia/Karachi');\n        return date.format('MMMM Do YYYY (h:mm a)');\n      }\n    }]);\n  }\n\n  return /*#__PURE__*/React.createElement(FusePageSimple, {\n    header: /*#__PURE__*/React.createElement(Grid, {\n      container: true,\n      item: true,\n      justify: \"flex-end\",\n      direction: \"column\",\n      className: \"pl-12 pb-12\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(Typography, {\n      variant: \"h4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 6\n      }\n    }, \"Redemption\")),\n    content: /*#__PURE__*/React.createElement(Grid, {\n      container: true,\n      className: \"p-20\",\n      justify: \"space-between\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      md: 12,\n      className: \"mt-8\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(Paper, {\n      elevation: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Grid, {\n      container: true,\n      spacing: 4,\n      alignItems: \"center\",\n      className: \"ml-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      md: 3,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(TextField, {\n      id: \"from\",\n      name: \"fromDate\",\n      label: \"From\",\n      type: \"date\",\n      InputLabelProps: {\n        shrink: true\n      },\n      fullWidth: true,\n      variant: \"outlined\",\n      onChange: onChange,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 10\n      }\n    })), /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      md: 3,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(TextField, {\n      id: \"to\",\n      name: \"toDate\",\n      label: \"To\",\n      type: \"date\",\n      InputLabelProps: {\n        shrink: true\n      },\n      fullWidth: true,\n      variant: \"outlined\",\n      onChange: onChange,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 10\n      }\n    })), /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      disabled: disabled,\n      className: \"mt-6\",\n      onClick: data,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 10\n      }\n    }, \"Search\"))))), /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      className: \"mt-28\",\n      md: 12,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(MaterialTable, {\n      title: \"Redemptions\",\n      data: redemptions,\n      isLoading: loading,\n      columns: getColumns(),\n      actions: [{\n        icon: 'save',\n        isFreeAction: true,\n        onClick: function onClick() {}\n      }],\n      options: {\n        pageSize: 10,\n        pageSizeOptions: [10, 20, 50],\n        actionsColumnIndex: -1,\n        exportButton: true,\n        exportAllData: true\n      },\n      components: {\n        Action: Action\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 7\n      }\n    }))),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 3\n    }\n  });\n}\n\nfunction mapStateToProps(_ref2) {\n  var auth = _ref2.auth;\n  return {\n    user: auth.user\n  };\n}\n\nexport default connect(mapStateToProps)(Redemption);","map":{"version":3,"sources":["D:/Projects/live/src/app/main/redemption/Redemptions.js"],"names":["React","useState","useEffect","Grid","Typography","Paper","TextField","Button","FusePageSimple","MaterialTable","JwtService","connect","Add","moment","Redemption","user","currentDate","toDate","setToDate","fromDate","setFromDate","redemptions","setRedemptions","loading","setLoading","disabled","setDisabled","today","Date","dd","String","getDate","padStart","mm","getMonth","yyyy","getFullYear","data","onChange","event","target","name","value","axios","getAxios","params","date_from","date_to","role","vendor_id","xid","get","vendors","resp","Action","props","action","icon","getColumns","column","title","field","push","render","rowData","date","created_at","tz","format","shrink","isFreeAction","onClick","pageSize","pageSizeOptions","actionsColumnIndex","exportButton","exportAllData","mapStateToProps","auth"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Grid, Typography, Paper, TextField, Button } from '@material-ui/core';\nimport FusePageSimple from '@fuse/core/FusePageSimple';\nimport MaterialTable from 'material-table';\nimport JwtService from 'app/services/jwtService';\nimport { connect } from 'react-redux';\nimport Add from './Add';\nimport moment from 'moment-timezone';\n\nfunction Redemption({ user }) {\n\tconst [toDate, setToDate] = useState(currentDate());\n\tconst [fromDate, setFromDate] = useState(currentDate());\n\tconst [redemptions, setRedemptions] = useState([]);\n\tconst [loading, setLoading] = useState(true);\n\tconst [disabled, setDisabled] = useState(true);\n\n\tfunction currentDate() {\n\t\tvar today = new Date();\n\t\tvar dd = String(today.getDate()).padStart(2, '0');\n\t\tvar mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!\n\t\tvar yyyy = today.getFullYear();\n\n\t\treturn yyyy + '-' + mm + '-' + dd;\n\t}\n\n\tuseEffect(() => {\n\t\t// eslint-disable-next-line\n\t\tif (loading) setDisabled(false);\n\t}, [loading]);\n\tuseEffect(() => {\n\t\tif (toDate && fromDate) data();\n\t\t// eslint-disable-next-line\n\t}, []);\n\t// }, [toDate, fromDate]);\n\n\tfunction onChange(event) {\n\t\tconst target = event.target;\n\t\tif (target.name === 'toDate') {\n\t\t\tsetToDate(target.value);\n\t\t} else {\n\t\t\tsetFromDate(target.value);\n\t\t}\n\t}\n\n\tasync function data() {\n\t\tsetLoading(true);\n\t\tconst axios = JwtService.getAxios();\n\n\t\tconst params = {\n\t\t\tdate_from: fromDate,\n\t\t\tdate_to: toDate\n\t\t};\n\n\t\tif (user.data.role === 'vendor') params.vendor_id = user.data.xid;\n\t\tconst vendors = await axios.get('/api/admin/redemption', {\n\t\t\tparams\n\t\t});\n\t\tconst resp = vendors.data;\n\t\tsetLoading(false);\n\t\treturn setRedemptions(resp.data);\n\t}\n\n\tfunction Action(props) {\n\t\tswitch (props.action.icon) {\n\t\t\tcase 'save':\n\t\t\t\treturn user.data.role === 'marketing' ? <></> : <Add reload={data} />;\n\t\t\tdefault:\n\t\t\t\treturn <></>;\n\t\t}\n\t}\n\n\tfunction getColumns() {\n\t\tconst column = [\n\t\t\t{\n\t\t\t\ttitle: 'App Name',\n\t\t\t\tfield: 'appname'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'User Name',\n\t\t\t\tfield: 'user'\n\t\t\t}\n\t\t];\n\n\t\tif (user.data.role === 'admin') {\n\t\t\tcolumn.push({\n\t\t\t\ttitle: 'Email',\n\t\t\t\tfield: 'email'\n\t\t\t});\n\t\t\tcolumn.push({\n\t\t\t\ttitle: 'Savings',\n\t\t\t\tfield: 'total_savings'\n\t\t\t});\n\t\t}\n\n\t\treturn [\n\t\t\t...column,\n\t\t\t{\n\t\t\t\ttitle: 'Brand',\n\t\t\t\tfield: 'vendor'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Locality',\n\t\t\t\tfield: 'locality'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'City',\n\t\t\t\tfield: 'city'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Voucher',\n\t\t\t\tfield: 'voucher'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Reference Code',\n\t\t\t\tfield: 'reference_code'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttitle: 'Time',\n\t\t\t\tfield: 'created_at',\n\t\t\t\trender: rowData => {\n\t\t\t\t\tconst date = moment(rowData.created_at).tz('Asia/Karachi');\n\t\t\t\t\treturn date.format('MMMM Do YYYY (h:mm a)');\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t}\n\n\treturn (\n\t\t<FusePageSimple\n\t\t\theader={\n\t\t\t\t<Grid container item justify=\"flex-end\" direction=\"column\" className=\"pl-12 pb-12\">\n\t\t\t\t\t<Typography variant=\"h4\">Redemption</Typography>\n\t\t\t\t</Grid>\n\t\t\t}\n\t\t\tcontent={\n\t\t\t\t<Grid container className=\"p-20\" justify=\"space-between\">\n\t\t\t\t\t<Grid item md={12} className=\"mt-8\">\n\t\t\t\t\t\t<Paper elevation={4}>\n\t\t\t\t\t\t\t<Grid container spacing={4} alignItems=\"center\" className=\"ml-4\">\n\t\t\t\t\t\t\t\t<Grid item md={3}>\n\t\t\t\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\t\t\t\tid=\"from\"\n\t\t\t\t\t\t\t\t\t\tname=\"fromDate\"\n\t\t\t\t\t\t\t\t\t\tlabel=\"From\"\n\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\tInputLabelProps={{\n\t\t\t\t\t\t\t\t\t\t\tshrink: true\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tfullWidth\n\t\t\t\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\t\t\t\tonChange={onChange}\n\t\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t\t<Grid item md={3}>\n\t\t\t\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\t\t\t\tid=\"to\"\n\t\t\t\t\t\t\t\t\t\tname=\"toDate\"\n\t\t\t\t\t\t\t\t\t\tlabel=\"To\"\n\t\t\t\t\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\t\t\t\t\tInputLabelProps={{\n\t\t\t\t\t\t\t\t\t\t\tshrink: true\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tfullWidth\n\t\t\t\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\t\t\t\tonChange={onChange}\n\t\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Grid>\n\n\t\t\t\t\t\t\t\t<Grid item>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\t\t\t\t\t\tcolor=\"primary\"\n\t\t\t\t\t\t\t\t\t\tdisabled={disabled}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mt-6\"\n\t\t\t\t\t\t\t\t\t\tonClick={data}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tSearch\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t\t\t\t</Paper>\n\t\t\t\t\t</Grid>\n\t\t\t\t\t<Grid item className=\"mt-28\" md={12}>\n\t\t\t\t\t\t<MaterialTable\n\t\t\t\t\t\t\ttitle=\"Redemptions\"\n\t\t\t\t\t\t\tdata={redemptions}\n\t\t\t\t\t\t\tisLoading={loading}\n\t\t\t\t\t\t\tcolumns={getColumns()}\n\t\t\t\t\t\t\tactions={[\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ticon: 'save',\n\t\t\t\t\t\t\t\t\tisFreeAction: true,\n\t\t\t\t\t\t\t\t\tonClick: () => {}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\toptions={{\n\t\t\t\t\t\t\t\tpageSize: 10,\n\t\t\t\t\t\t\t\tpageSizeOptions: [10, 20, 50],\n\t\t\t\t\t\t\t\tactionsColumnIndex: -1,\n\t\t\t\t\t\t\t\texportButton: true,\n\t\t\t\t\t\t\t\texportAllData: true\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tcomponents={{\n\t\t\t\t\t\t\t\tAction\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Grid>\n\t\t\t\t</Grid>\n\t\t\t}\n\t\t/>\n\t);\n}\n\nfunction mapStateToProps({ auth }) {\n\treturn {\n\t\tuser: auth.user\n\t};\n}\n\nexport default connect(mapStateToProps)(Redemption);\n"]},"metadata":{},"sourceType":"module"}