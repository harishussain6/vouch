{"ast":null,"code":"import _classCallCheck from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import FuseUtils from'@fuse/utils/FuseUtils';import axios from'axios';import jwtDecode from'jwt-decode';/* seslint-disable camelcase */axios.defaults.baseURL='https://portalendpoint.vouch365.xyz/';// axios.defaults.baseURL = 'https://adminportaltest.vouch365.mobi/';\n// axios.defaults.baseURL = 'http://localhost:8000/';\n// axios.defaults.baseURL = 'https://adminportalstaging.vouch365.club/';\naxios.defaults.headers.common['Access-Control-Allow-Origin']='*';// axios.defaults.headers.common[\"Access-Control-Allow-Methods\"] = \"GET,PUT,POST,DELETE,PATCH,OPTIONS\";\nvar JwtService=/*#__PURE__*/function(_FuseUtils$EventEmitt){_inherits(JwtService,_FuseUtils$EventEmitt);var _super=_createSuper(JwtService);function JwtService(){var _this;_classCallCheck(this,JwtService);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.setInterceptors=function(){axios.interceptors.response.use(function(response){return response;},function(err){return new Promise(function(resolve,reject){console.log(err);if(err.response&&err.response.status===401&&err.config&&!err.config.__isRetryRequest){// if you ever get an unauthorized response, logout the user\n_this.emit('onAutoLogout','Invalid access_token');_this.setSession(null);}throw err;});});};_this.handleAuthentication=function(){var access_token=_this.getAccessToken();var user_type=localStorage.getItem('user_type');if(!access_token){_this.emit('onNoAccessToken');return;}if(_this.isAuthTokenValid(access_token)){_this.setSession(access_token,user_type);_this.emit('onAutoLogin',true);}else{_this.setSession(null);_this.emit('onAutoLogout','access_token expired');}};_this.createUser=function(data){return new Promise(function(resolve,reject){axios.post('/api/auth/register',data).then(function(response){if(response.data.user){_this.setSession(response.data.access_token);resolve(response.data.user);}else{reject(response.data.error);}});});};_this.signInWithEmailAndPassword=function(email,password){return new Promise(function(resolve,reject){axios.get('api/login',{params:{email:email,password:password}}).then(function(response){var actualResponse=response.data;if(actualResponse.status){_this.setSession(actualResponse.data.token,actualResponse.data.user.user_type);resolve(actualResponse.data.user);}else{reject(actualResponse.errors);}});});};_this.signInWithToken=function(){return new Promise(function(resolve,reject){var _user_type;var user_type=localStorage.getItem('user_type');user_type=(_user_type=user_type)!==null&&_user_type!==void 0?_user_type:'api';axios.get(\"/api/admin/verify-token/\".concat(user_type),{}).then(function(response){var actualResponse=response.data;if(actualResponse&&actualResponse.status){resolve(actualResponse.data);}else{_this.logout();reject(new Error('Failed to login with token.'));}}).catch(function(error){console.log(error);_this.logout();reject(new Error('Failed to login with token.'));});});};_this.updateUserData=function(user){return axios.post('/api/auth/user/update',{user:user});};_this.setSession=function(access_token,user_type){if(access_token&&user_type){user_type=['vendor','vendor_api'].includes(user_type)?'vendor_api':'api';localStorage.setItem('token',access_token);localStorage.setItem('user_type',user_type);axios.defaults.headers.common.Authorization=\"Bearer \".concat(access_token);}else{localStorage.removeItem('token');localStorage.removeItem('user_type');delete axios.defaults.headers.common.Authorization;}};_this.logout=function(){_this.setSession(null);};_this.isAuthTokenValid=function(access_token){if(!access_token){return false;}var decoded=jwtDecode(access_token);var currentTime=Date.now()/1000;if(decoded.exp<currentTime){console.warn('access token expired');return false;}return true;};_this.getAccessToken=function(){return window.localStorage.getItem('token');};_this.getAxios=function(){return axios;};return _this;}_createClass(JwtService,[{key:\"init\",value:function init(){this.setInterceptors();this.handleAuthentication();}},{key:\"authBroadcastUrl\",value:function authBroadcastUrl(){return axios.defaults.baseURL+'api/broadcasting/auth';}}]);return JwtService;}(FuseUtils.EventEmitter);var instance=new JwtService();export default instance;","map":null,"metadata":{},"sourceType":"module"}