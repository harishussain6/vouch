{"ast":null,"code":"import _objectSpread from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _regeneratorRuntime from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"D:\\\\Projects\\\\live\\\\src\\\\app\\\\main\\\\global-notification\\\\GlobalNotification.js\";\nimport FuseAnimate from '@fuse/core/FuseAnimate';\nimport FuseChipSelect from '@fuse/core/FuseChipSelect';\nimport FuseLoading from '@fuse/core/FuseLoading';\nimport FusePageCarded from '@fuse/core/FusePageCarded';\nimport { useForm } from '@fuse/hooks';\nimport _ from '@lodash';\nimport { Button, Icon, TextField, Typography } from '@material-ui/core';\nimport { useTheme } from '@material-ui/core/styles';\nimport JwtService from 'app/services/jwtService';\nimport React, { useEffect, useState, useContext } from 'react';\nimport { Link, useHistory } from 'react-router-dom';\nimport fileUpload from 'fuctbase64';\nimport { SnackbarContext } from 'app/context/SnackbarContext';\nimport VendorSearch from '../common/VendorSearch';\nvar premiumKey = {\n  message: '',\n  image: '',\n  title: '',\n  city_id: {},\n  city_name: '',\n  linktype: 'url',\n  link: ''\n};\n\nfunction GlobalNotification(_ref) {\n  var props = _ref.props;\n\n  var _useState = useState(true),\n      _useState2 = _slicedToArray(_useState, 2),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      cities = _useState4[0],\n      setCities = _useState4[1];\n\n  var _useState5 = useState('url'),\n      _useState6 = _slicedToArray(_useState5, 2),\n      linkType = _useState6[0],\n      setLinkType = _useState6[1];\n\n  var _useState7 = useState({}),\n      _useState8 = _slicedToArray(_useState7, 2),\n      errors = _useState8[0],\n      setError = _useState8[1];\n\n  var theme = useTheme();\n\n  var _useForm = useForm(premiumKey),\n      form = _useForm.form,\n      handleChange = _useForm.handleChange,\n      setForm = _useForm.setForm;\n\n  var history = useHistory();\n  var axios = JwtService.getAxios();\n  var context = useContext(SnackbarContext);\n  useEffect(function () {\n    if (cities.length > 0) setLoading(false);\n    setLinkType(premiumKey.linktype);\n  }, [cities]);\n  useEffect(function () {\n    var getData = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                try {\n                  axios.get('/api/admin/city').then(function (res) {\n                    var data = res.data.data;\n                    setCities(data.cities);\n                  });\n                } catch (error) {\n                  console.log('error');\n                  setLoading(false);\n                }\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function getData() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    getData(); // eslint-disable-next-line\n  }, []);\n\n  function handleChipChange(value, name) {\n    if (name === 'linktype') {\n      console.log(value);\n      setLinkType(value.value);\n      setForm(_.set(_objectSpread({}, form), name, value.value));\n      console.log(linkType);\n    } else setForm(_.set(_objectSpread({}, form), name, value));\n  }\n\n  function headerUpload(files) {\n    fileUpload(files).then(function (data) {\n      setForm(_.set(_objectSpread({}, form), \"image\", \"data:\".concat(data.type, \";base64,\").concat(data.base64)));\n    });\n  }\n\n  function setVendor(value) {\n    setForm(_.set(_objectSpread({}, form), 'link', value));\n  }\n\n  function canBeSubmitted() {\n    return form.message.length > 0 && form.title.length > 0 && Object.keys(form.city_id).length === 2;\n  }\n\n  function onSubmit() {\n    return _onSubmit.apply(this, arguments);\n  }\n\n  function _onSubmit() {\n    _onSubmit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var params, result, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              setLoading(true);\n              params = {\n                message: form.message,\n                title: form.title,\n                city_id: form.city_id.value,\n                city_name: form.city_id.label,\n                linktype: form.linktype,\n                link: form.link\n              };\n\n              if (form.image) {\n                params['image'] = form.image;\n              }\n\n              _context2.next = 6;\n              return axios.post('/api/admin/send-global-notification', params);\n\n            case 6:\n              result = _context2.sent;\n              console.log(result);\n              res = result.data;\n\n              if (!res.status) {\n                setLoading(false);\n                context.setMessage(res.message);\n                context.setSeverity('error');\n                context.setOpen(true);\n              } else {\n                history.push('/global-notifications');\n              }\n\n              _context2.next = 15;\n              break;\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(_context2.t0);\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 12]]);\n    }));\n    return _onSubmit.apply(this, arguments);\n  }\n\n  if (loading) {\n    return /*#__PURE__*/React.createElement(FuseLoading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 10\n      }\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(FusePageCarded, {\n    classes: {\n      toolbar: 'p-0',\n      header: 'min-h-72 h-72 sm:h-136 sm:min-h-136'\n    },\n    header: form && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"flex flex-1 w-full items-center justify-between\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"flex flex-col items-start max-w-full\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(FuseAnimate, {\n      animation: \"transition.slideRightIn\",\n      delay: 300,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 8\n      }\n    }, /*#__PURE__*/React.createElement(Typography, {\n      className: \"normal-case flex items-center sm:mb-12\",\n      component: Link,\n      role: \"button\",\n      to: \"/\",\n      color: \"inherit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Icon, {\n      className: \"text-20\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 10\n      }\n    }, theme.direction === 'ltr' ? 'arrow_back' : 'arrow_forward'), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"mx-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 10\n      }\n    }, \"Send Global Notification\")))), /*#__PURE__*/React.createElement(FuseAnimate, {\n      animation: \"transition.slideRightIn\",\n      delay: 300,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      className: \"whitespace-no-wrap normal-case\",\n      variant: \"contained\",\n      color: \"secondary\",\n      disabled: !canBeSubmitted(),\n      onClick: onSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 8\n      }\n    }, 'Submit'))),\n    content: form && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"p-16 sm:p-24 max-w-2xl\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(TextField, {\n      className: \"mt-8 mb-8\",\n      id: \"title\",\n      name: \"title\",\n      onChange: handleChange,\n      label: \"Title Of Notification\",\n      value: form.title,\n      variant: \"outlined\",\n      fullWidth: true,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 8\n      }\n    }), /*#__PURE__*/React.createElement(TextField, {\n      className: \"mt-8 mb-8\",\n      id: \"message\",\n      name: \"message\",\n      onChange: handleChange,\n      label: \"Message\",\n      value: form.message,\n      variant: \"outlined\",\n      fullWidth: true,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 8\n      }\n    }), /*#__PURE__*/React.createElement(TextField, {\n      className: \"mt-8 mb-8\",\n      id: \"image\",\n      name: \"image\",\n      onChange: headerUpload,\n      label: \"Image\",\n      type: \"file\",\n      variant: \"outlined\",\n      fullWidth: true,\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 8\n      }\n    }), /*#__PURE__*/React.createElement(FuseChipSelect, {\n      className: \"mt-8 mb-8\",\n      value: form.city_id,\n      onChange: function onChange(value) {\n        return handleChipChange(value, 'city_id');\n      },\n      textFieldProps: {\n        label: 'City',\n        InputLabelProps: {\n          shrink: true\n        },\n        variant: 'outlined'\n      },\n      options: cities.map(function (city) {\n        return {\n          value: city.id,\n          label: city.name\n        };\n      }),\n      required: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 8\n      }\n    }), /*#__PURE__*/React.createElement(FuseChipSelect, {\n      className: \"mt-8 mb-8\",\n      value: {\n        value: form.linktype.value ? form.linktype.value : form.linktype,\n        label: form.linktype.label ? form.linktype.label : form.linktype.toUpperCase()\n      },\n      onChange: function onChange(value) {\n        return handleChipChange(value, 'linktype');\n      },\n      textFieldProps: {\n        label: 'link Type',\n        InputLabelProps: {\n          shrink: true\n        },\n        variant: 'outlined'\n      },\n      options: [{\n        value: 'vendor',\n        label: 'Vendor'\n      }, {\n        value: 'url',\n        label: 'URL'\n      }],\n      error: errors['linktype'],\n      helperText: errors['linktype'] ? errors['linktype'][0] : '',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 8\n      }\n    }), linkType === 'vendor' ? /*#__PURE__*/React.createElement(VendorSearch, {\n      setValue: setVendor,\n      selectedVendor: (form === null || form === void 0 ? void 0 : form.vendor) || null,\n      error: errors['link'],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }\n    }) : /*#__PURE__*/React.createElement(React.Fragment, null), linkType === 'url' ? /*#__PURE__*/React.createElement(TextField, {\n      autoFocus: true,\n      margin: \"dense\",\n      className: \"mt-8 mb-8\",\n      id: \"link\",\n      name: \"link\",\n      label: \"Link\",\n      type: \"text\",\n      fullWidth: true,\n      value: form.link,\n      onChange: handleChange,\n      variant: \"outlined\",\n      error: errors['link'] ? true : false,\n      helperText: errors['link'] ? errors['link'][0] : null,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 9\n      }\n    }) : /*#__PURE__*/React.createElement(React.Fragment, null))),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 3\n    }\n  });\n}\n\nexport default GlobalNotification;","map":{"version":3,"sources":["D:/Projects/live/src/app/main/global-notification/GlobalNotification.js"],"names":["FuseAnimate","FuseChipSelect","FuseLoading","FusePageCarded","useForm","_","Button","Icon","TextField","Typography","useTheme","JwtService","React","useEffect","useState","useContext","Link","useHistory","fileUpload","SnackbarContext","VendorSearch","premiumKey","message","image","title","city_id","city_name","linktype","link","GlobalNotification","props","loading","setLoading","cities","setCities","linkType","setLinkType","errors","setError","theme","form","handleChange","setForm","history","axios","getAxios","context","length","getData","get","then","res","data","error","console","log","handleChipChange","value","name","set","headerUpload","files","type","base64","setVendor","canBeSubmitted","Object","keys","onSubmit","params","label","post","result","status","setMessage","setSeverity","setOpen","push","toolbar","header","direction","InputLabelProps","shrink","variant","map","city","id","toUpperCase","vendor"],"mappings":"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","sourcesContent":["import FuseAnimate from '@fuse/core/FuseAnimate';\nimport FuseChipSelect from '@fuse/core/FuseChipSelect';\nimport FuseLoading from '@fuse/core/FuseLoading';\nimport FusePageCarded from '@fuse/core/FusePageCarded';\nimport { useForm } from '@fuse/hooks';\nimport _ from '@lodash';\nimport { Button, Icon, TextField, Typography } from '@material-ui/core';\nimport { useTheme } from '@material-ui/core/styles';\nimport JwtService from 'app/services/jwtService';\nimport React, { useEffect, useState, useContext } from 'react';\nimport { Link, useHistory } from 'react-router-dom';\nimport fileUpload from 'fuctbase64';\nimport { SnackbarContext } from 'app/context/SnackbarContext';\nimport VendorSearch from '../common/VendorSearch';\n\nconst premiumKey = {\n\tmessage: '',\n\timage: '',\n\ttitle: '',\n\tcity_id: {},\n\tcity_name: '',\n\tlinktype: 'url',\n\tlink: ''\n};\nfunction GlobalNotification({ props }) {\n\tconst [loading, setLoading] = useState(true);\n\tconst [cities, setCities] = useState([]);\n\tconst [linkType, setLinkType] = useState('url');\n\tconst [errors, setError] = useState({});\n\tconst theme = useTheme();\n\tconst { form, handleChange, setForm } = useForm(premiumKey);\n\tconst history = useHistory();\n\tconst axios = JwtService.getAxios();\n\tconst context = useContext(SnackbarContext);\n\n\tuseEffect(() => {\n\t\tif (cities.length > 0) setLoading(false);\n\t\tsetLinkType(premiumKey.linktype);\n\t}, [cities]);\n\tuseEffect(() => {\n\t\tconst getData = async () => {\n\t\t\ttry {\n\t\t\t\taxios.get('/api/admin/city').then(res => {\n\t\t\t\t\tconst data = res.data.data;\n\t\t\t\t\tsetCities(data.cities);\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('error');\n\t\t\t\tsetLoading(false);\n\t\t\t}\n\t\t};\n\t\tgetData();\n\t\t// eslint-disable-next-line\n\t}, []);\n\n\tfunction handleChipChange(value, name) {\n\t\tif (name === 'linktype') {\n\t\t\tconsole.log(value);\n\t\t\tsetLinkType(value.value);\n\t\t\tsetForm(_.set({ ...form }, name, value.value));\n\t\t\tconsole.log(linkType);\n\t\t} else setForm(_.set({ ...form }, name, value));\n\t}\n\n\tfunction headerUpload(files) {\n\t\tfileUpload(files).then(data => {\n\t\t\tsetForm(_.set({ ...form }, `image`, `data:${data.type};base64,${data.base64}`));\n\t\t});\n\t}\n\n\tfunction setVendor(value) {\n\t\tsetForm(_.set({ ...form }, 'link', value));\n\t}\n\n\tfunction canBeSubmitted() {\n\t\treturn form.message.length > 0 && form.title.length > 0 && Object.keys(form.city_id).length === 2;\n\t}\n\n\tasync function onSubmit() {\n\t\ttry {\n\t\t\tsetLoading(true);\n\t\t\tconst params = {\n\t\t\t\tmessage: form.message,\n\t\t\t\ttitle: form.title,\n\t\t\t\tcity_id: form.city_id.value,\n\t\t\t\tcity_name: form.city_id.label,\n\t\t\t\tlinktype: form.linktype,\n\t\t\t\tlink: form.link\n\t\t\t};\n\t\t\tif (form.image) {\n\t\t\t\tparams['image'] = form.image;\n\t\t\t}\n\n\t\t\tconst result = await axios.post('/api/admin/send-global-notification', params);\n\t\t\tconsole.log(result);\n\t\t\tconst res = result.data;\n\t\t\tif (!res.status) {\n\t\t\t\tsetLoading(false);\n\t\t\t\tcontext.setMessage(res.message);\n\t\t\t\tcontext.setSeverity('error');\n\t\t\t\tcontext.setOpen(true);\n\t\t\t} else {\n\t\t\t\thistory.push('/global-notifications');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\t}\n\n\tif (loading) {\n\t\treturn <FuseLoading />;\n\t}\n\n\treturn (\n\t\t<FusePageCarded\n\t\t\tclasses={{\n\t\t\t\ttoolbar: 'p-0',\n\t\t\t\theader: 'min-h-72 h-72 sm:h-136 sm:min-h-136'\n\t\t\t}}\n\t\t\theader={\n\t\t\t\tform && (\n\t\t\t\t\t<div className=\"flex flex-1 w-full items-center justify-between\">\n\t\t\t\t\t\t<div className=\"flex flex-col items-start max-w-full\">\n\t\t\t\t\t\t\t<FuseAnimate animation=\"transition.slideRightIn\" delay={300}>\n\t\t\t\t\t\t\t\t<Typography\n\t\t\t\t\t\t\t\t\tclassName=\"normal-case flex items-center sm:mb-12\"\n\t\t\t\t\t\t\t\t\tcomponent={Link}\n\t\t\t\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\t\t\t\tto=\"/\"\n\t\t\t\t\t\t\t\t\tcolor=\"inherit\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Icon className=\"text-20\">\n\t\t\t\t\t\t\t\t\t\t{theme.direction === 'ltr' ? 'arrow_back' : 'arrow_forward'}\n\t\t\t\t\t\t\t\t\t</Icon>\n\t\t\t\t\t\t\t\t\t<span className=\"mx-4\">Send Global Notification</span>\n\t\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t\t</FuseAnimate>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<FuseAnimate animation=\"transition.slideRightIn\" delay={300}>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tclassName=\"whitespace-no-wrap normal-case\"\n\t\t\t\t\t\t\t\tvariant=\"contained\"\n\t\t\t\t\t\t\t\tcolor=\"secondary\"\n\t\t\t\t\t\t\t\tdisabled={!canBeSubmitted()}\n\t\t\t\t\t\t\t\tonClick={onSubmit}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{'Submit'}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</FuseAnimate>\n\t\t\t\t\t</div>\n\t\t\t\t)\n\t\t\t}\n\t\t\tcontent={\n\t\t\t\tform && (\n\t\t\t\t\t<div className=\"p-16 sm:p-24 max-w-2xl\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\t\tclassName=\"mt-8 mb-8\"\n\t\t\t\t\t\t\t\tid=\"title\"\n\t\t\t\t\t\t\t\tname=\"title\"\n\t\t\t\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\t\t\t\tlabel=\"Title Of Notification\"\n\t\t\t\t\t\t\t\tvalue={form.title}\n\t\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\t\tfullWidth\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\t\tclassName=\"mt-8 mb-8\"\n\t\t\t\t\t\t\t\tid=\"message\"\n\t\t\t\t\t\t\t\tname=\"message\"\n\t\t\t\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\t\t\t\tlabel=\"Message\"\n\t\t\t\t\t\t\t\tvalue={form.message}\n\t\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\t\tfullWidth\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\t\tclassName=\"mt-8 mb-8\"\n\t\t\t\t\t\t\t\tid=\"image\"\n\t\t\t\t\t\t\t\tname=\"image\"\n\t\t\t\t\t\t\t\tonChange={headerUpload}\n\t\t\t\t\t\t\t\tlabel=\"Image\"\n\t\t\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\t\tfullWidth\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<FuseChipSelect\n\t\t\t\t\t\t\t\tclassName=\"mt-8 mb-8\"\n\t\t\t\t\t\t\t\tvalue={form.city_id}\n\t\t\t\t\t\t\t\tonChange={value => handleChipChange(value, 'city_id')}\n\t\t\t\t\t\t\t\ttextFieldProps={{\n\t\t\t\t\t\t\t\t\tlabel: 'City',\n\t\t\t\t\t\t\t\t\tInputLabelProps: {\n\t\t\t\t\t\t\t\t\t\tshrink: true\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tvariant: 'outlined'\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\toptions={cities.map(city => ({\n\t\t\t\t\t\t\t\t\tvalue: city.id,\n\t\t\t\t\t\t\t\t\tlabel: city.name\n\t\t\t\t\t\t\t\t}))}\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<FuseChipSelect\n\t\t\t\t\t\t\t\tclassName=\"mt-8 mb-8\"\n\t\t\t\t\t\t\t\tvalue={{\n\t\t\t\t\t\t\t\t\tvalue: form.linktype.value ? form.linktype.value : form.linktype,\n\t\t\t\t\t\t\t\t\tlabel: form.linktype.label ? form.linktype.label : form.linktype.toUpperCase()\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonChange={value => handleChipChange(value, 'linktype')}\n\t\t\t\t\t\t\t\ttextFieldProps={{\n\t\t\t\t\t\t\t\t\tlabel: 'link Type',\n\t\t\t\t\t\t\t\t\tInputLabelProps: {\n\t\t\t\t\t\t\t\t\t\tshrink: true\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tvariant: 'outlined'\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\toptions={[\n\t\t\t\t\t\t\t\t\t{ value: 'vendor', label: 'Vendor' },\n\t\t\t\t\t\t\t\t\t{ value: 'url', label: 'URL' }\n\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\terror={errors['linktype']}\n\t\t\t\t\t\t\t\thelperText={errors['linktype'] ? errors['linktype'][0] : ''}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{linkType === 'vendor' ? (\n\t\t\t\t\t\t\t\t<VendorSearch\n\t\t\t\t\t\t\t\t\tsetValue={setVendor}\n\t\t\t\t\t\t\t\t\tselectedVendor={form?.vendor || null}\n\t\t\t\t\t\t\t\t\terror={errors['link']}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<></>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{linkType === 'url' ? (\n\t\t\t\t\t\t\t\t<TextField\n\t\t\t\t\t\t\t\t\tautoFocus\n\t\t\t\t\t\t\t\t\tmargin=\"dense\"\n\t\t\t\t\t\t\t\t\tclassName=\"mt-8 mb-8\"\n\t\t\t\t\t\t\t\t\tid=\"link\"\n\t\t\t\t\t\t\t\t\tname=\"link\"\n\t\t\t\t\t\t\t\t\tlabel=\"Link\"\n\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\tfullWidth\n\t\t\t\t\t\t\t\t\tvalue={form.link}\n\t\t\t\t\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t\t\t\t\t\terror={errors['link'] ? true : false}\n\t\t\t\t\t\t\t\t\thelperText={errors['link'] ? errors['link'][0] : null}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<></>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t)\n\t\t\t}\n\t\t/>\n\t);\n}\n\nexport default GlobalNotification;\n"]},"metadata":{},"sourceType":"module"}