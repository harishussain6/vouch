{"ast":null,"code":"import _classCallCheck from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"D:\\\\Projects\\\\live\\\\src\\\\app\\\\auth\\\\Auth.js\";\nimport FuseSplashScreen from '@fuse/core/FuseSplashScreen';\nimport * as userActions from 'app/auth/store/actions';\nimport { UserContext } from 'app/context/UserContext';\nimport auth0Service from 'app/services/auth0Service';\nimport firebaseService from 'app/services/firebaseService';\nimport jwtService from 'app/services/jwtService';\nimport * as Actions from 'app/store/actions';\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\n\nvar Auth = /*#__PURE__*/function (_Component) {\n  _inherits(Auth, _Component);\n\n  var _super = _createSuper(Auth);\n\n  function Auth() {\n    var _this;\n\n    _classCallCheck(this, Auth);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      waitAuthCheck: true,\n      user: null\n    };\n\n    _this.jwtCheck = function () {\n      return new Promise(function (resolve) {\n        jwtService.on('onAutoLogin', function () {\n          // this.props.showMessage({ message: 'Welcome Back', variant: 'success' });\n\n          /**\n           * Sign in and retrieve user data from Api\n           */\n          jwtService.signInWithToken().then(function (user) {\n            _this.props.setUserData(user);\n\n            resolve(); // this.props.showMessage({ message: 'Welcome Back', variant: 'success' });\n\n            _this.setState({\n              user: user\n            });\n          }).catch(function (error) {\n            _this.props.showMessage({\n              message: error,\n              variant: 'error'\n            });\n\n            resolve();\n          });\n        });\n        jwtService.on('onAutoLogout', function (message) {\n          if (message) {// this.props.showMessage({ message, variant: 'success' });\n          }\n\n          _this.props.logout();\n\n          resolve();\n        });\n        jwtService.on('onNoAccessToken', function () {\n          resolve();\n        });\n        jwtService.init();\n        return Promise.resolve();\n      });\n    };\n\n    _this.auth0Check = function () {\n      return new Promise(function (resolve) {\n        auth0Service.init(function (success) {\n          if (!success) {\n            resolve();\n          }\n        });\n\n        if (auth0Service.isAuthenticated()) {\n          _this.props.showMessage({\n            message: 'Logging in with Auth0'\n          });\n          /**\n           * Retrieve user data from Auth0\n           */\n\n\n          auth0Service.getUserData().then(function (tokenData) {\n            _this.props.setUserDataAuth0(tokenData);\n\n            resolve();\n\n            _this.props.showMessage({\n              message: 'Logged in with Auth0'\n            });\n          });\n        } else {\n          resolve();\n        }\n\n        return Promise.resolve();\n      });\n    };\n\n    _this.firebaseCheck = function () {\n      return new Promise(function (resolve) {\n        firebaseService.init(function (success) {\n          if (!success) {\n            resolve();\n          }\n        });\n        firebaseService.onAuthStateChanged(function (authUser) {\n          if (authUser) {\n            _this.props.showMessage({\n              message: 'Logging in with Firebase'\n            });\n            /**\n             * Retrieve user data from Firebase\n             */\n\n\n            firebaseService.getUserData(authUser.uid).then(function (user) {\n              _this.props.setUserDataFirebase(user, authUser);\n\n              resolve();\n\n              _this.props.showMessage({\n                message: 'Logged in with Firebase'\n              });\n            }, function (error) {\n              resolve();\n            });\n          } else {\n            resolve();\n          }\n        });\n        return Promise.resolve();\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(Auth, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      return Promise.all([// Comment the lines which you do not use\n      // this.firebaseCheck(),\n      // this.auth0Check(),\n      this.jwtCheck()]).then(function () {\n        _this2.setState({\n          waitAuthCheck: false\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return /*#__PURE__*/React.createElement(UserContext.Consumer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 4\n        }\n      }, function (_ref) {\n        var create = _ref.create;\n        if (_this3.state.user) create(_this3.state.user);\n        return _this3.state.waitAuthCheck ? /*#__PURE__*/React.createElement(FuseSplashScreen, {\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 40\n          }\n        }) : /*#__PURE__*/React.createElement(React.Fragment, null, _this3.props.children);\n      });\n    }\n  }]);\n\n  return Auth;\n}(Component);\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators({\n    logout: userActions.logoutUser,\n    setUserData: userActions.setJWTUserData,\n    setUserDataAuth0: userActions.setUserDataAuth0,\n    setUserDataFirebase: userActions.setUserDataFirebase,\n    showMessage: Actions.showMessage,\n    hideMessage: Actions.hideMessage\n  }, dispatch);\n}\n\nexport default connect(null, mapDispatchToProps)(Auth);","map":{"version":3,"sources":["D:/Projects/live/src/app/auth/Auth.js"],"names":["FuseSplashScreen","userActions","UserContext","auth0Service","firebaseService","jwtService","Actions","React","Component","connect","bindActionCreators","Auth","state","waitAuthCheck","user","jwtCheck","Promise","resolve","on","signInWithToken","then","props","setUserData","setState","catch","error","showMessage","message","variant","logout","init","auth0Check","success","isAuthenticated","getUserData","tokenData","setUserDataAuth0","firebaseCheck","onAuthStateChanged","authUser","uid","setUserDataFirebase","all","create","children","mapDispatchToProps","dispatch","logoutUser","setJWTUserData","hideMessage"],"mappings":"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","sourcesContent":["import FuseSplashScreen from '@fuse/core/FuseSplashScreen';\nimport * as userActions from 'app/auth/store/actions';\nimport { UserContext } from 'app/context/UserContext';\nimport auth0Service from 'app/services/auth0Service';\nimport firebaseService from 'app/services/firebaseService';\nimport jwtService from 'app/services/jwtService';\nimport * as Actions from 'app/store/actions';\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\n\nclass Auth extends Component {\n\tstate = {\n\t\twaitAuthCheck: true,\n\t\tuser: null\n\t};\n\n\tcomponentDidMount() {\n\t\treturn Promise.all([\n\t\t\t// Comment the lines which you do not use\n\t\t\t// this.firebaseCheck(),\n\t\t\t// this.auth0Check(),\n\t\t\tthis.jwtCheck()\n\t\t]).then(() => {\n\t\t\tthis.setState({ waitAuthCheck: false });\n\t\t});\n\t}\n\n\tjwtCheck = () =>\n\t\tnew Promise(resolve => {\n\t\t\tjwtService.on('onAutoLogin', () => {\n\t\t\t\t// this.props.showMessage({ message: 'Welcome Back', variant: 'success' });\n\n\t\t\t\t/**\n\t\t\t\t * Sign in and retrieve user data from Api\n\t\t\t\t */\n\t\t\t\tjwtService\n\t\t\t\t\t.signInWithToken()\n\t\t\t\t\t.then(user => {\n\t\t\t\t\t\tthis.props.setUserData(user);\n\t\t\t\t\t\tresolve();\n\n\t\t\t\t\t\t// this.props.showMessage({ message: 'Welcome Back', variant: 'success' });\n\t\t\t\t\t\tthis.setState({ user });\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tthis.props.showMessage({ message: error, variant: 'error' });\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t});\n\n\t\t\tjwtService.on('onAutoLogout', message => {\n\t\t\t\tif (message) {\n\t\t\t\t\t// this.props.showMessage({ message, variant: 'success' });\n\t\t\t\t}\n\n\t\t\t\tthis.props.logout();\n\n\t\t\t\tresolve();\n\t\t\t});\n\n\t\t\tjwtService.on('onNoAccessToken', () => {\n\t\t\t\tresolve();\n\t\t\t});\n\n\t\t\tjwtService.init();\n\n\t\t\treturn Promise.resolve();\n\t\t});\n\n\tauth0Check = () =>\n\t\tnew Promise(resolve => {\n\t\t\tauth0Service.init(success => {\n\t\t\t\tif (!success) {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (auth0Service.isAuthenticated()) {\n\t\t\t\tthis.props.showMessage({ message: 'Logging in with Auth0' });\n\n\t\t\t\t/**\n\t\t\t\t * Retrieve user data from Auth0\n\t\t\t\t */\n\t\t\t\tauth0Service.getUserData().then(tokenData => {\n\t\t\t\t\tthis.props.setUserDataAuth0(tokenData);\n\n\t\t\t\t\tresolve();\n\n\t\t\t\t\tthis.props.showMessage({ message: 'Logged in with Auth0' });\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\treturn Promise.resolve();\n\t\t});\n\n\tfirebaseCheck = () =>\n\t\tnew Promise(resolve => {\n\t\t\tfirebaseService.init(success => {\n\t\t\t\tif (!success) {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfirebaseService.onAuthStateChanged(authUser => {\n\t\t\t\tif (authUser) {\n\t\t\t\t\tthis.props.showMessage({ message: 'Logging in with Firebase' });\n\n\t\t\t\t\t/**\n\t\t\t\t\t * Retrieve user data from Firebase\n\t\t\t\t\t */\n\t\t\t\t\tfirebaseService.getUserData(authUser.uid).then(\n\t\t\t\t\t\tuser => {\n\t\t\t\t\t\t\tthis.props.setUserDataFirebase(user, authUser);\n\n\t\t\t\t\t\t\tresolve();\n\n\t\t\t\t\t\t\tthis.props.showMessage({ message: 'Logged in with Firebase' });\n\t\t\t\t\t\t},\n\t\t\t\t\t\terror => {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn Promise.resolve();\n\t\t});\n\n\trender() {\n\t\treturn (\n\t\t\t<UserContext.Consumer>\n\t\t\t\t{({ create }) => {\n\t\t\t\t\tif (this.state.user) create(this.state.user);\n\t\t\t\t\treturn this.state.waitAuthCheck ? <FuseSplashScreen /> : <>{this.props.children}</>;\n\t\t\t\t}}\n\t\t\t</UserContext.Consumer>\n\t\t);\n\t}\n}\n\nfunction mapDispatchToProps(dispatch) {\n\treturn bindActionCreators(\n\t\t{\n\t\t\tlogout: userActions.logoutUser,\n\t\t\tsetUserData: userActions.setJWTUserData,\n\t\t\tsetUserDataAuth0: userActions.setUserDataAuth0,\n\t\t\tsetUserDataFirebase: userActions.setUserDataFirebase,\n\t\t\tshowMessage: Actions.showMessage,\n\t\t\thideMessage: Actions.hideMessage\n\t\t},\n\t\tdispatch\n\t);\n}\n\nexport default connect(null, mapDispatchToProps)(Auth);\n"]},"metadata":{},"sourceType":"module"}