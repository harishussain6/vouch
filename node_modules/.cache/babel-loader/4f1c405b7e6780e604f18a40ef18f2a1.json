{"ast":null,"code":"import _objectSpread from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{withStyles,TextField,Button,Grid,FormHelperText,Icon,Typography}from'@material-ui/core';import{useForm}from'@fuse/hooks';import _ from'@lodash';import FuseChipSelect from'@fuse/core/FuseChipSelect';import{useHistory,useParams}from'react-router';import JwtService from'app/services/jwtService';import FusePageCarded from'@fuse/core/FusePageCarded';import FuseAnimate from'@fuse/core/FuseAnimate';import FuseLoading from'@fuse/core/FuseLoading';import{useTheme}from'@material-ui/core/styles';import{Link}from'react-router-dom';import fileUpload from'fuctbase64';import VendorSearch from'../common/VendorSearch';import OfferSearch from'../common/OfferSearch';var styles=function styles(){return{};};function getSlider(){var slide=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return slide?slide:{id:null,title:'',image:'',linktype:'url',link:'',partner:{id:1,name:'vouch365'},membership:{id:1,name:''},city:{id:1,name:''},category:{id:1,name:''},timout:'',flavor:'retail',status:'inactive'};}function PopupCreate(){var _useState=useState(getSlider()),_useState2=_slicedToArray(_useState,2),slide=_useState2[0],setSlide=_useState2[1];var _useForm=useForm(null),form=_useForm.form,handleChange=_useForm.handleChange,setForm=_useForm.setForm;var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),categories=_useState4[0],setCategories=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),memberships=_useState6[0],setMemberships=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),partners=_useState8[0],setPartners=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),cities=_useState10[0],setCities=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),sliders=_useState12[0],setSliders=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),errors=_useState14[0],setError=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),errorMessage=_useState16[0],setErrorMessage=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),loading=_useState18[0],setLoading=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),linkType=_useState20[0],setLinkType=_useState20[1];var _useParams=useParams(),id=_useParams.id;var axios=JwtService.getAxios();var theme=useTheme();var history=useHistory();useEffect(function(){console.log(memberships);if(categories.length>0&&sliders.length>0&&partners.length>0&&memberships.length>0&&cities.length>0)setLoading(false);},[categories,sliders,partners,memberships,cities]);useEffect(function(){if(slide&&!form||slide&&form&&slide.id!==form.id){setForm(slide);setLinkType(slide.linktype);}},[form,slide,setForm]);function canBeSubmitted(){return!_.isEqual(slide,form);}useEffect(function(){var getData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!(id!=='new')){_context.next=12;break;}_context.prev=2;_context.next=5;return axios.get(\"/api/admin/popup/\".concat(id));case 5:res=_context.sent;if(res.data.status){setSlide(res.data.data.popup);}else{setErrorMessage(res.data.message);setError(res.data.errors);}_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);setError(_context.t0);case 12:axios.get('/api/admin/category').then(function(res){var data=res.data.data;setCategories(data.category);});axios.get('/api/admin/city').then(function(res){var data=res.data.data;setCities(data.cities);});axios.get('/api/admin/membership').then(function(res){var data=res.data.data;setMemberships(data.membership);});axios.get('/api/admin/slider').then(function(res){var data=res.data.data;setSliders(data.sliders);});axios.get('/api/admin/partner').then(function(res){var data=res.data.data;setPartners(data.partners);});_context.next=22;break;case 19:_context.prev=19;_context.t1=_context[\"catch\"](0);setLoading(false);case 22:case\"end\":return _context.stop();}}},_callee,null,[[0,19],[2,9]]);}));return function getData(){return _ref.apply(this,arguments);};}();getData();// eslint-disable-next-line\n},[]);function handleChipChange(value,name){console.log(value);var setValue=Array.isArray(value)?value.map(function(item){return{id:item.value,name:item.label};}):{id:value.value,name:value.label};if(name==='linktype')setLinkType(value.value);setForm(_.set(_objectSpread({},form),name,setValue));}function dataToPost(){console.log(form.link);var post=_objectSpread(_objectSpread({},form),{},{link:form.link?form.link.toString():undefined,partner_id:form.partner.id,membership_id:form.membership.id,city_id:form.city.id,category_id:form.category.id,linktype:form.linktype.id?form.linktype.id:form.linktype,status:form.status.id?form.status.id:form.status,flavor:form.flavor.id?form.flavor.id:form.flavor});delete post.partner;delete post.membership;delete post.city;delete post.category;delete post.slider;return post;}function add(){return _add.apply(this,arguments);}function _add(){_add=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);console.log('add');_context2.prev=2;_context2.next=5;return axios.post('/api/admin/popup',dataToPost());case 5:res=_context2.sent;if(res.data.status){history.push('/popup');}else{setErrorMessage(res.data.message);setError(res.data.errors);}_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);console.log(_context2.t0);setError(_context2.t0);case 13:setLoading(false);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[2,9]]);}));return _add.apply(this,arguments);}function update(){return _update.apply(this,arguments);}function _update(){_update=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setLoading(true);_context3.next=3;return axios.put(\"/api/admin/popup/\".concat(id),dataToPost());case 3:res=_context3.sent;if(res.data.status){history.push('/popup');}else{setErrorMessage(res.data.message);setError(res.data.errors);}case 5:case\"end\":return _context3.stop();}}},_callee3);}));return _update.apply(this,arguments);}function onSubmit(){if(id==='new')add();else update();}function imageUpload(_x){return _imageUpload.apply(this,arguments);}function _imageUpload(){_imageUpload=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(files){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:fileUpload(files).then(function(data){setForm(_.set(_objectSpread({},form),\"image\",\"data:\".concat(data.type,\";base64,\").concat(data.base64)));});case 1:case\"end\":return _context4.stop();}}},_callee4);}));return _imageUpload.apply(this,arguments);}function setVendor(value){setForm(_.set(_objectSpread({},form),'link',value));}function setOffer(value){setForm(_.set(_objectSpread({},form),'link',value));}if(loading){return/*#__PURE__*/React.createElement(FuseLoading,null);}return/*#__PURE__*/React.createElement(FusePageCarded,{classes:{toolbar:'p-0',header:'min-h-72 h-72 sm:h-136 sm:min-h-136'},header:form&&/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-1 w-full items-center justify-between\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-col items-start max-w-full\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{className:\"normal-case flex items-center sm:mb-12\",component:Link,role:\"button\",to:\"/popup\",color:\"inherit\"},/*#__PURE__*/React.createElement(Icon,{className:\"text-20\"},theme.direction==='ltr'?'arrow_back':'arrow_forward'),/*#__PURE__*/React.createElement(\"span\",{className:\"mx-4\"},\"Popups\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"flex items-center max-w-full\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-col min-w-0 mx-8 sm:mc-16\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideLeftIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{className:\"text-16 sm:text-20 truncate\"},form.title?form.title:'New Popup')))))),content:form&&/*#__PURE__*/React.createElement(\"div\",{className:\"p-16 sm:p-24 max-w-2xl\"},/*#__PURE__*/React.createElement(Grid,{container:true},/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FormHelperText,{error:true},errorMessage)),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"title\",name:\"title\",onChange:handleChange,label:\"Title\",value:form.title,variant:\"outlined\",fullWidth:true,error:errors['title'],helperText:errors['title']?errors['title'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.linktype.id?form.linktype.id:form.linktype,label:form.linktype.name?form.linktype.name:form.linktype.toUpperCase()},onChange:function onChange(value){return handleChipChange(value,'linktype');},textFieldProps:{label:'link Type',InputLabelProps:{shrink:true},variant:'outlined'},options:[{value:'vendor',label:'Vendor'},{value:'url',label:'URL'},{value:'offertype',label:'Offer Type'},{value:'tab',label:'Tab'}],error:errors['linktype'],helperText:errors['linktype']?errors['linktype'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},linkType==='vendor'?/*#__PURE__*/React.createElement(VendorSearch,{setValue:setVendor,selectedVendor:(form===null||form===void 0?void 0:form.vendor)||null,error:errors['link']}):/*#__PURE__*/React.createElement(React.Fragment,null),linkType==='url'||linkType==='tab'?/*#__PURE__*/React.createElement(TextField,{autoFocus:true,margin:\"dense\",id:\"link\",name:\"link\",label:\"Link\",type:\"text\",fullWidth:true,value:form.link,onChange:handleChange,className:\"mt-8 mb-8\",variant:\"outlined\",error:errors['link']?true:false,helperText:errors['link']?errors['link'][0]:null}):/*#__PURE__*/React.createElement(React.Fragment,null),linkType==='offertype'?/*#__PURE__*/React.createElement(OfferSearch,{setValue:setOffer,error:errors['link'],incomingOffer:form.link}):/*#__PURE__*/React.createElement(React.Fragment,null)),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.flavor.id?form.flavor.id:form.flavor,label:form.flavor.name?form.flavor.name:form.flavor.toUpperCase()},onChange:function onChange(value){return handleChipChange(value,'flavor');},textFieldProps:{label:'Flavor',InputLabelProps:{shrink:true},variant:'outlined'},options:[{value:'retail',label:'Retail'},{value:'fusion',label:'Fusion'},{value:'gold',label:'Gold'},{value:'landing',label:'Landing'}],error:errors['flavor'],helperText:errors['flavor']?errors['flavor'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"image\",name:\"image\",onChange:imageUpload,label:\"image\",type:\"file\",variant:\"outlined\",InputLabelProps:{shrink:true},fullWidth:true,error:errors['image'],helperText:errors['image']?errors['image'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"timout\",name:\"timout\",onChange:handleChange,value:form.timout,label:\"Time Out\",variant:\"outlined\",InputLabelProps:{shrink:true},fullWidth:true,error:errors['timout'],helperText:errors['timout']?errors['timout'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{isDisabled:true,className:\"mt-8 mb-8\",value:!form.partner?form.partner_id:{value:form.partner.id,label:form.partner.name},onChange:function onChange(value){return handleChipChange(value,'partner');},placeholder:\"Select multiple partners\",textFieldProps:{label:'Partners',InputLabelProps:{shrink:true},variant:'outlined'},options:partners.map(function(partner){return{value:partner.id,label:partner.name};}),error:errors['partner_id'],helperText:errors['partner_id']?errors['partner_id'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:!form.membership?form.membership_id:{value:form.membership.id,label:form.membership.name},onChange:function onChange(value){return handleChipChange(value,'membership');},placeholder:\"Select multiple memberships\",textFieldProps:{label:'Memberships',InputLabelProps:{shrink:true},variant:'outlined'},options:memberships.map(function(membership){return{value:membership.id,label:membership.name};}),error:errors['membership_ids'],helperText:errors['membership_ids']?errors['membership_ids'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:!form.city?form.city_id:{value:form.city.id,label:form.city.name},onChange:function onChange(value){return handleChipChange(value,'city');},textFieldProps:{label:'City',InputLabelProps:{shrink:true},variant:'outlined'},options:cities.map(function(city){return{value:city.id,label:city.name};}),error:errors['city_id'],helperText:errors['city_id']?errors['city_id'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:form.category_id===null?{}:{value:form.category.id,label:form.category.name},onChange:function onChange(value){return handleChipChange(value,'category');},textFieldProps:{label:'Categories',InputLabelProps:{shrink:true},variant:'outlined'},options:categories.map(function(category){return{value:category.id,label:category.name};}),error:errors['category_id'],helperText:errors['category_id']?errors['category_id'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:form.status.id?{value:form.status.id,label:form.status.name}:{value:form.status,label:form.status.toUpperCase()},onChange:function onChange(value){return handleChipChange(value,'status');},textFieldProps:{label:'Status',InputLabelProps:{shrink:true},variant:'outlined'},options:[{value:'active',label:'Active'},{value:'inactive',label:'InActive'}],error:errors['status'],helperText:errors['status']?errors['status'][0]:''})),/*#__PURE__*/React.createElement(Grid,{container:true,item:true,md:12,justify:\"flex-end\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Button,{className:\"whitespace-no-wrap normal-case\",variant:\"contained\",color:\"secondary\",disabled:loading||!canBeSubmitted(),onClick:onSubmit},id==='new'?'Save':'Update')))))});}export default withStyles(styles)(PopupCreate);","map":null,"metadata":{},"sourceType":"module"}