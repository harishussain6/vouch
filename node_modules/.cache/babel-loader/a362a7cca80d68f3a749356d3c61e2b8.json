{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Grid,Typography,Paper,TextField,Button}from'@material-ui/core';import FusePageSimple from'@fuse/core/FusePageSimple';import MaterialTable from'material-table';import JwtService from'app/services/jwtService';import{connect}from'react-redux';import Add from'./Add';import moment from'moment-timezone';function Redemption(_ref){var user=_ref.user;var _useState=useState(currentDate()),_useState2=_slicedToArray(_useState,2),toDate=_useState2[0],setToDate=_useState2[1];var _useState3=useState(currentDate()),_useState4=_slicedToArray(_useState3,2),fromDate=_useState4[0],setFromDate=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),redemptions=_useState6[0],setRedemptions=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),disabled=_useState10[0],setDisabled=_useState10[1];function currentDate(){var today=new Date();var dd=String(today.getDate()).padStart(2,'0');var mm=String(today.getMonth()+1).padStart(2,'0');//January is 0!\nvar yyyy=today.getFullYear();return yyyy+'-'+mm+'-'+dd;}useEffect(function(){// eslint-disable-next-line\nif(loading)setDisabled(false);},[loading]);useEffect(function(){if(toDate&&fromDate)data();// eslint-disable-next-line\n},[]);// }, [toDate, fromDate]);\nfunction onChange(event){var target=event.target;if(target.name==='toDate'){setToDate(target.value);}else{setFromDate(target.value);}}function data(){return _data.apply(this,arguments);}function _data(){_data=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var axios,params,vendors,resp;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);axios=JwtService.getAxios();params={date_from:fromDate,date_to:toDate};if(user.data.role==='vendor')params.vendor_id=user.data.xid;_context.next=6;return axios.get('/api/admin/redemption',{params:params});case 6:vendors=_context.sent;resp=vendors.data;setLoading(false);return _context.abrupt(\"return\",setRedemptions(resp.data));case 10:case\"end\":return _context.stop();}}},_callee);}));return _data.apply(this,arguments);}function Action(props){switch(props.action.icon){case'save':return user.data.role==='marketing'?/*#__PURE__*/React.createElement(React.Fragment,null):/*#__PURE__*/React.createElement(Add,{reload:data});default:return/*#__PURE__*/React.createElement(React.Fragment,null);}}function getColumns(){var column=[{title:'App Name',field:'appname'},{title:'User Name',field:'user'}];if(user.data.role==='admin'){column.push({title:'Email',field:'email'});column.push({title:'Savings',field:'total_savings'});}return[].concat(column,[{title:'Brand',field:'vendor'},{title:'Locality',field:'locality'},{title:'City',field:'city'},{title:'Voucher',field:'voucher'},{title:'Reference Code',field:'reference_code'},{title:'Time',field:'created_at',render:function render(rowData){var date=moment(rowData.created_at).tz('Asia/Karachi');return date.format('MMMM Do YYYY (h:mm a)');}}]);}return/*#__PURE__*/React.createElement(FusePageSimple,{header:/*#__PURE__*/React.createElement(Grid,{container:true,item:true,justify:\"flex-end\",direction:\"column\",className:\"pl-12 pb-12\"},/*#__PURE__*/React.createElement(Typography,{variant:\"h4\"},\"Redemption\")),content:/*#__PURE__*/React.createElement(Grid,{container:true,className:\"p-20\",justify:\"space-between\"},/*#__PURE__*/React.createElement(Grid,{item:true,md:12,className:\"mt-8\"},/*#__PURE__*/React.createElement(Paper,{elevation:4},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:4,alignItems:\"center\",className:\"ml-4\"},/*#__PURE__*/React.createElement(Grid,{item:true,md:3},/*#__PURE__*/React.createElement(TextField,{id:\"from\",name:\"fromDate\",label:\"From\",type:\"date\",InputLabelProps:{shrink:true},fullWidth:true,variant:\"outlined\",onChange:onChange,required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:3},/*#__PURE__*/React.createElement(TextField,{id:\"to\",name:\"toDate\",label:\"To\",type:\"date\",InputLabelProps:{shrink:true},fullWidth:true,variant:\"outlined\",onChange:onChange,required:true})),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Button,{variant:\"contained\",color:\"primary\",disabled:disabled,className:\"mt-6\",onClick:data},\"Search\"))))),/*#__PURE__*/React.createElement(Grid,{item:true,className:\"mt-28\",md:12},/*#__PURE__*/React.createElement(MaterialTable,{title:\"Redemptions\",data:redemptions,isLoading:loading,columns:getColumns(),actions:[{icon:'save',isFreeAction:true,onClick:function onClick(){}}],options:{pageSize:10,pageSizeOptions:[10,20,50],actionsColumnIndex:-1,exportButton:true,exportAllData:true},components:{Action:Action}})))});}function mapStateToProps(_ref2){var auth=_ref2.auth;return{user:auth.user};}export default connect(mapStateToProps)(Redemption);","map":null,"metadata":{},"sourceType":"module"}