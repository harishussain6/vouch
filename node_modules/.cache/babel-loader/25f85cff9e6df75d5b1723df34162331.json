{"ast":null,"code":"import _classCallCheck from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\nimport FuseUtils from '@fuse/utils/FuseUtils';\nimport axios from 'axios';\nimport jwtDecode from 'jwt-decode';\n/* seslint-disable camelcase */\n// axios.defaults.baseURL = 'https://portalendpoint.vouch365.xyz/';\n\naxios.defaults.baseURL = 'https://adminportaltest.vouch365.mobi/'; // axios.defaults.baseURL = 'http://localhost:8000/';\n// axios.defaults.baseURL = 'https://adminportalstaging.vouch365.club/';\n\naxios.defaults.headers.common['Access-Control-Allow-Origin'] = '*'; // axios.defaults.headers.common[\"Access-Control-Allow-Methods\"] = \"GET,PUT,POST,DELETE,PATCH,OPTIONS\";\n\nvar JwtService = /*#__PURE__*/function (_FuseUtils$EventEmitt) {\n  _inherits(JwtService, _FuseUtils$EventEmitt);\n\n  var _super = _createSuper(JwtService);\n\n  function JwtService() {\n    var _this;\n\n    _classCallCheck(this, JwtService);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _this.setInterceptors = function () {\n      axios.interceptors.response.use(function (response) {\n        return response;\n      }, function (err) {\n        return new Promise(function (resolve, reject) {\n          console.log(err);\n\n          if (err.response && err.response.status === 401 && err.config && !err.config.__isRetryRequest) {\n            // if you ever get an unauthorized response, logout the user\n            _this.emit('onAutoLogout', 'Invalid access_token');\n\n            _this.setSession(null);\n          }\n\n          throw err;\n        });\n      });\n    };\n\n    _this.handleAuthentication = function () {\n      var access_token = _this.getAccessToken();\n\n      var user_type = localStorage.getItem('user_type');\n\n      if (!access_token) {\n        _this.emit('onNoAccessToken');\n\n        return;\n      }\n\n      if (_this.isAuthTokenValid(access_token)) {\n        _this.setSession(access_token, user_type);\n\n        _this.emit('onAutoLogin', true);\n      } else {\n        _this.setSession(null);\n\n        _this.emit('onAutoLogout', 'access_token expired');\n      }\n    };\n\n    _this.createUser = function (data) {\n      return new Promise(function (resolve, reject) {\n        axios.post('/api/auth/register', data).then(function (response) {\n          if (response.data.user) {\n            _this.setSession(response.data.access_token);\n\n            resolve(response.data.user);\n          } else {\n            reject(response.data.error);\n          }\n        });\n      });\n    };\n\n    _this.signInWithEmailAndPassword = function (email, password) {\n      return new Promise(function (resolve, reject) {\n        axios.get('api/login', {\n          params: {\n            email: email,\n            password: password\n          }\n        }).then(function (response) {\n          var actualResponse = response.data;\n\n          if (actualResponse.status) {\n            _this.setSession(actualResponse.data.token, actualResponse.data.user.user_type);\n\n            resolve(actualResponse.data.user);\n          } else {\n            reject(actualResponse.errors);\n          }\n        });\n      });\n    };\n\n    _this.signInWithToken = function () {\n      return new Promise(function (resolve, reject) {\n        var _user_type;\n\n        var user_type = localStorage.getItem('user_type');\n        user_type = (_user_type = user_type) !== null && _user_type !== void 0 ? _user_type : 'api';\n        axios.get(\"/api/admin/verify-token/\".concat(user_type), {}).then(function (response) {\n          var actualResponse = response.data;\n\n          if (actualResponse && actualResponse.status) {\n            resolve(actualResponse.data);\n          } else {\n            _this.logout();\n\n            reject(new Error('Failed to login with token.'));\n          }\n        }).catch(function (error) {\n          console.log(error);\n\n          _this.logout();\n\n          reject(new Error('Failed to login with token.'));\n        });\n      });\n    };\n\n    _this.updateUserData = function (user) {\n      return axios.post('/api/auth/user/update', {\n        user: user\n      });\n    };\n\n    _this.setSession = function (access_token, user_type) {\n      if (access_token && user_type) {\n        user_type = ['vendor', 'vendor_api'].includes(user_type) ? 'vendor_api' : 'api';\n        localStorage.setItem('token', access_token);\n        localStorage.setItem('user_type', user_type);\n        axios.defaults.headers.common.Authorization = \"Bearer \".concat(access_token);\n      } else {\n        localStorage.removeItem('token');\n        localStorage.removeItem('user_type');\n        delete axios.defaults.headers.common.Authorization;\n      }\n    };\n\n    _this.logout = function () {\n      _this.setSession(null);\n    };\n\n    _this.isAuthTokenValid = function (access_token) {\n      if (!access_token) {\n        return false;\n      }\n\n      var decoded = jwtDecode(access_token);\n      var currentTime = Date.now() / 1000;\n\n      if (decoded.exp < currentTime) {\n        console.warn('access token expired');\n        return false;\n      }\n\n      return true;\n    };\n\n    _this.getAccessToken = function () {\n      return window.localStorage.getItem('token');\n    };\n\n    _this.getAxios = function () {\n      return axios;\n    };\n\n    return _this;\n  }\n\n  _createClass(JwtService, [{\n    key: \"init\",\n    value: function init() {\n      this.setInterceptors();\n      this.handleAuthentication();\n    }\n  }, {\n    key: \"authBroadcastUrl\",\n    value: function authBroadcastUrl() {\n      return axios.defaults.baseURL + 'api/broadcasting/auth';\n    }\n  }]);\n\n  return JwtService;\n}(FuseUtils.EventEmitter);\n\nvar instance = new JwtService();\nexport default instance;","map":{"version":3,"sources":["D:/Projects/live/src/app/services/jwtService/jwtService.js"],"names":["FuseUtils","axios","jwtDecode","defaults","baseURL","headers","common","JwtService","setInterceptors","interceptors","response","use","err","Promise","resolve","reject","console","log","status","config","__isRetryRequest","emit","setSession","handleAuthentication","access_token","getAccessToken","user_type","localStorage","getItem","isAuthTokenValid","createUser","data","post","then","user","error","signInWithEmailAndPassword","email","password","get","params","actualResponse","token","errors","signInWithToken","logout","Error","catch","updateUserData","includes","setItem","Authorization","removeItem","decoded","currentTime","Date","now","exp","warn","window","getAxios","EventEmitter","instance"],"mappings":"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","sourcesContent":["import FuseUtils from '@fuse/utils/FuseUtils';\nimport axios from 'axios';\nimport jwtDecode from 'jwt-decode';\n/* seslint-disable camelcase */\n\n// axios.defaults.baseURL = 'https://portalendpoint.vouch365.xyz/';\naxios.defaults.baseURL = 'https://adminportaltest.vouch365.mobi/';\n// axios.defaults.baseURL = 'http://localhost:8000/';\n// axios.defaults.baseURL = 'https://adminportalstaging.vouch365.club/';\naxios.defaults.headers.common['Access-Control-Allow-Origin'] = '*';\n// axios.defaults.headers.common[\"Access-Control-Allow-Methods\"] = \"GET,PUT,POST,DELETE,PATCH,OPTIONS\";\n\nclass JwtService extends FuseUtils.EventEmitter {\n\tinit() {\n\t\tthis.setInterceptors();\n\t\tthis.handleAuthentication();\n\t}\n\n\tsetInterceptors = () => {\n\t\taxios.interceptors.response.use(\n\t\t\tresponse => {\n\t\t\t\treturn response;\n\t\t\t},\n\t\t\terr => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t\tif (err.response && err.response.status === 401 && err.config && !err.config.__isRetryRequest) {\n\t\t\t\t\t\t// if you ever get an unauthorized response, logout the user\n\t\t\t\t\t\tthis.emit('onAutoLogout', 'Invalid access_token');\n\t\t\t\t\t\tthis.setSession(null);\n\t\t\t\t\t}\n\t\t\t\t\tthrow err;\n\t\t\t\t});\n\t\t\t}\n\t\t);\n\t};\n\n\tauthBroadcastUrl() {\n\t\treturn axios.defaults.baseURL + 'api/broadcasting/auth';\n\t}\n\thandleAuthentication = () => {\n\t\tconst access_token = this.getAccessToken();\n\t\tconst user_type = localStorage.getItem('user_type');\n\t\tif (!access_token) {\n\t\t\tthis.emit('onNoAccessToken');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isAuthTokenValid(access_token)) {\n\t\t\tthis.setSession(access_token, user_type);\n\t\t\tthis.emit('onAutoLogin', true);\n\t\t} else {\n\t\t\tthis.setSession(null);\n\t\t\tthis.emit('onAutoLogout', 'access_token expired');\n\t\t}\n\t};\n\n\tcreateUser = data => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\taxios.post('/api/auth/register', data).then(response => {\n\t\t\t\tif (response.data.user) {\n\t\t\t\t\tthis.setSession(response.data.access_token);\n\t\t\t\t\tresolve(response.data.user);\n\t\t\t\t} else {\n\t\t\t\t\treject(response.data.error);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n\n\tsignInWithEmailAndPassword = (email, password) => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\taxios\n\t\t\t\t.get('api/login', {\n\t\t\t\t\tparams: {\n\t\t\t\t\t\temail,\n\t\t\t\t\t\tpassword\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(response => {\n\t\t\t\t\tconst actualResponse = response.data;\n\t\t\t\t\tif (actualResponse.status) {\n\t\t\t\t\t\tthis.setSession(actualResponse.data.token, actualResponse.data.user.user_type);\n\t\t\t\t\t\tresolve(actualResponse.data.user);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(actualResponse.errors);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t};\n\n\tsignInWithToken = () => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet user_type = localStorage.getItem('user_type');\n\t\t\tuser_type = user_type ?? 'api';\n\t\t\taxios\n\t\t\t\t.get(`/api/admin/verify-token/${user_type}`, {})\n\t\t\t\t.then(response => {\n\t\t\t\t\tconst actualResponse = response.data;\n\t\t\t\t\tif (actualResponse && actualResponse.status) {\n\t\t\t\t\t\tresolve(actualResponse.data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.logout();\n\t\t\t\t\t\treject(new Error('Failed to login with token.'));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tthis.logout();\n\t\t\t\t\treject(new Error('Failed to login with token.'));\n\t\t\t\t});\n\t\t});\n\t};\n\n\tupdateUserData = user => {\n\t\treturn axios.post('/api/auth/user/update', {\n\t\t\tuser\n\t\t});\n\t};\n\n\tsetSession = (access_token, user_type) => {\n\t\tif (access_token && user_type) {\n\t\t\tuser_type = ['vendor', 'vendor_api'].includes(user_type) ? 'vendor_api' : 'api';\n\t\t\tlocalStorage.setItem('token', access_token);\n\t\t\tlocalStorage.setItem('user_type', user_type);\n\t\t\taxios.defaults.headers.common.Authorization = `Bearer ${access_token}`;\n\t\t} else {\n\t\t\tlocalStorage.removeItem('token');\n\t\t\tlocalStorage.removeItem('user_type');\n\t\t\tdelete axios.defaults.headers.common.Authorization;\n\t\t}\n\t};\n\n\tlogout = () => {\n\t\tthis.setSession(null);\n\t};\n\n\tisAuthTokenValid = access_token => {\n\t\tif (!access_token) {\n\t\t\treturn false;\n\t\t}\n\t\tconst decoded = jwtDecode(access_token);\n\t\tconst currentTime = Date.now() / 1000;\n\t\tif (decoded.exp < currentTime) {\n\t\t\tconsole.warn('access token expired');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tgetAccessToken = () => {\n\t\treturn window.localStorage.getItem('token');\n\t};\n\n\tgetAxios = () => {\n\t\treturn axios;\n\t};\n}\n\nconst instance = new JwtService();\n\nexport default instance;\n"]},"metadata":{},"sourceType":"module"}