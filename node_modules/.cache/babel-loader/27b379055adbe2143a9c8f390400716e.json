{"ast":null,"code":"import _objectSpread from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import FuseAnimate from'@fuse/core/FuseAnimate';import FuseChipSelect from'@fuse/core/FuseChipSelect';import FuseLoading from'@fuse/core/FuseLoading';import FusePageCarded from'@fuse/core/FusePageCarded';import{useForm}from'@fuse/hooks';import _ from'@lodash';import{Button,Checkbox,FormControlLabel,Icon,TextField,Typography}from'@material-ui/core';import{useTheme}from'@material-ui/core/styles';import JwtService from'app/services/jwtService';import React,{useEffect,useState}from'react';import{Link,useHistory}from'react-router-dom';import currentDate from'app/utils/helpers';var premiumKey={name:'',prefix:'',multi_voucher:0,no_of_keys:10,act_date:currentDate(),exp_date:currentDate(),allowed_redemptions:12,children:[],partner:{},membership:{},cities:[],type:'random',serial_start:0,add365days:0,all_city_access:0};function CreatePremiumKey(_ref){var props=_ref.props;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),memberships=_useState4[0],setMemberships=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),partners=_useState6[0],setPartners=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),cities=_useState8[0],setCities=_useState8[1];var theme=useTheme();var _useForm=useForm(premiumKey),form=_useForm.form,handleChange=_useForm.handleChange,setForm=_useForm.setForm;var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),errors=_useState10[0],setErrors=_useState10[1];var history=useHistory();var axios=JwtService.getAxios();useEffect(function(){if(partners.length>0&&memberships.length>0&&cities.length>0)setLoading(false);},[partners,memberships,cities]);useEffect(function(){var getData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:try{axios.get('/api/admin/city').then(function(res){var data=res.data.data;setCities(data.cities);});axios.get('/api/admin/membership').then(function(res){var data=res.data.data;setMemberships(data.membership);});axios.get('/api/admin/partner').then(function(res){var data=res.data.data;setPartners(data.partners);});}catch(error){console.log('error');setLoading(false);}case 1:case\"end\":return _context.stop();}}},_callee);}));return function getData(){return _ref2.apply(this,arguments);};}();getData();// eslint-disable-next-line\n},[]);function canBeSubmitted(){return form.name.length>0&&!_.isEqual(premiumKey,form);}function onSubmit(){return _onSubmit.apply(this,arguments);}function _onSubmit(){_onSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var post,result,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setLoading(true);post=_objectSpread(_objectSpread({},form),{},{city_id:form.cities.map(function(city){return city.id;}),membership_id:form.membership.id,partner_id:form.partner.id,type:form.type.id?form.type.id:form.type,add365days:form.add365days?1:0,all_city_access:form.all_city_access?1:0});_context2.next=5;return axios.post('/api/admin/premium-key/create',post);case 5:result=_context2.sent;res=result.data;if(!res.status){setErrors(res.errors);setLoading(false);}else{history.push('/premium_key');}_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return _onSubmit.apply(this,arguments);}function handleChipChange(value,name){var setValue=Array.isArray(value)?value.map(function(item){return{id:item.value,name:item.label};}):{id:value.value,name:value.label};setForm(_.set(_objectSpread({},form),name,setValue));}if(loading){return/*#__PURE__*/React.createElement(FuseLoading,null);}return/*#__PURE__*/React.createElement(FusePageCarded,{classes:{toolbar:'p-0',header:'min-h-72 h-72 sm:h-136 sm:min-h-136'},header:form&&/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-1 w-full items-center justify-between\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-col items-start max-w-full\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{className:\"normal-case flex items-center sm:mb-12\",component:Link,role:\"button\",to:\"/premium_key\",color:\"inherit\"},/*#__PURE__*/React.createElement(Icon,{className:\"text-20\"},theme.direction==='ltr'?'arrow_back':'arrow_forward'),/*#__PURE__*/React.createElement(\"span\",{className:\"mx-4\"},\"Premium Key Generation\")))),/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Button,{className:\"whitespace-no-wrap normal-case\",variant:\"contained\",color:\"secondary\",disabled:!canBeSubmitted(),onClick:onSubmit},'Generate'))),content:form&&/*#__PURE__*/React.createElement(\"div\",{className:\"p-16 sm:p-24 max-w-2xl\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",error:errors['name']?true:false,helperText:errors['name']?errors['name'][0]:'',required:true,label:\"Name\",id:\"name\",name:\"name\",value:form.name,onChange:handleChange,variant:\"outlined\",fullWidth:true}),/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",error:errors['prefix']?true:false,helperText:errors['prefix']?errors['prefix'][0]:'',required:true,label:\"Prefix\",id:\"prefix\",name:\"prefix\",value:form.prefix,onChange:handleChange,variant:\"outlined\",fullWidth:true}),/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"multi_voucher\",error:errors['multi_voucher']?true:false,helperText:errors['multi_voucher']?errors['multi_voucher'][0]:'',name:\"multi_voucher\",onChange:handleChange,required:true,label:\"Multi Voucher\",type:\"numeric\",value:form.multi_voucher,variant:\"outlined\",fullWidth:true}),/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"no_of_keys\",name:\"no_of_keys\",onChange:handleChange,label:\"No Of Keys\",type:\"numeric\",value:form.no_of_keys,variant:\"outlined\",fullWidth:true,error:errors['no_of_keys']?true:false,helperText:errors['no_of_keys']?errors['no_of_keys'][0]:''}),/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"allowed_redemptions\",name:\"allowed_redemptions\",onChange:handleChange,label:\"Allowed Redemptions\",type:\"numeric\",value:form.allowed_redemptions,variant:\"outlined\",fullWidth:true,error:errors['allowed_redemptions']?true:false,helperText:errors['allowed_redemptions']?errors['allowed_redemptions'][0]:'',required:true}),/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"serial_start\",name:\"serial_start\",onChange:handleChange,label:\"Serial Start\",type:\"numeric\",value:form.serial_start,variant:\"outlined\",fullWidth:true,error:errors['serial_start']?true:false,helperText:errors['serial_start']?errors['serial_start'][0]:'',required:true}),/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.type.id?form.type.id:form.type,label:form.type.name?form.type.name:form.type.toUpperCase()},onChange:function onChange(value){return handleChipChange(value,'type');},textFieldProps:{label:'Type',InputLabelProps:{shrink:true},variant:'outlined'},options:[{value:'random',label:'Random'},{value:'specific',label:'Specific'},{value:'serial',label:'Serial'}],error:errors['serial']?true:false,helperText:errors['serial']?errors['serial'][0]:''}),/*#__PURE__*/React.createElement(FormControlLabel,{control:/*#__PURE__*/React.createElement(Checkbox,{checked:form.add365days?true:false,onChange:handleChange,name:\"add365days\",color:\"primary\"}),className:\"mt-8 mb-8\",label:\"Add 365 Days\"}),/*#__PURE__*/React.createElement(FormControlLabel,{control:/*#__PURE__*/React.createElement(Checkbox,{checked:form.all_city_access?true:false,onChange:handleChange,name:\"all_city_access\",color:\"primary\"}),className:\"mt-8 mb-8\",label:\"All Cities Access\"}),/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"act_date\",name:\"act_date\",onChange:handleChange,label:\"Activation Date\",type:\"date\",value:form.act_date,variant:\"outlined\",fullWidth:true,error:errors['act_date']?true:false,helperText:errors['act_date']?errors['act_date'][0]:'',required:true}),/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"exp_date\",name:\"exp_date\",onChange:handleChange,label:\"Expiry Date\",type:\"date\",value:form.exp_date,variant:\"outlined\",fullWidth:true,error:errors['exp_date']?true:false,helperText:errors['exp_date']?errors['exp_date'][0]:'',required:true}),/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:form.cities.map(function(city){return{value:city.id,label:city.name};}),onChange:function onChange(value){return handleChipChange(value,'cities');},textFieldProps:{label:'City',InputLabelProps:{shrink:true},variant:'outlined'},options:cities.map(function(city){return{value:city.id,label:city.name};}),isMulti:true,error:errors['city_id']?true:false,helperText:errors['city_id']?errors['city_id'][0]:'',required:true}),/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.membership.id,label:form.membership.name},onChange:function onChange(value){return handleChipChange(value,'membership');},placeholder:\"Select memberships\",textFieldProps:{label:'Memberships',InputLabelProps:{shrink:true},variant:'outlined'},options:memberships.map(function(membership){return{value:membership.id,label:membership.name};}),error:errors['membership_ids']?true:false,helperText:errors['membership_ids']?errors['membership_ids'][0]:'',required:true}),/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.partner.id,label:form.partner.name},onChange:function onChange(value){return handleChipChange(value,'partner');},placeholder:\"Select partner\",textFieldProps:{label:'Partners',InputLabelProps:{shrink:true},variant:'outlined'},options:partners.map(function(partner){return{value:partner.id,label:partner.name};}),error:errors['partner_id']?true:false,helperText:errors['partner_id']?errors['partner_id'][0]:'',required:true})))});}export default CreatePremiumKey;","map":null,"metadata":{},"sourceType":"module"}