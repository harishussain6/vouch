{"ast":null,"code":"import _objectSpread from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useContext}from'react';import{withStyles,TextField,Button,Grid,FormHelperText,Icon,Typography,Tabs,Tab}from'@material-ui/core';import{useForm}from'@fuse/hooks';import _ from'@lodash';import{useHistory,useParams}from'react-router';import JwtService from'app/services/jwtService';import FusePageCarded from'@fuse/core/FusePageCarded';import FuseAnimate from'@fuse/core/FuseAnimate';import FuseLoading from'@fuse/core/FuseLoading';import{useTheme}from'@material-ui/core/styles';import{Link}from'react-router-dom';import FuseChipSelect from'@fuse/core/FuseChipSelect';import Posts from'./Posts';import{UserContext}from'app/context/UserContext';var styles=function styles(){return{};};var axios=JwtService.getAxios();function getOrder(){var slide=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;return slide?slide:{task:'',description:'',user:{},status:'active',task_type:'vendor',duration:'daily',vendor:{},no_of_tasks:1,no_of_tasks_completed:0};}function TaskCreate(){var _useState=useState(getOrder()),_useState2=_slicedToArray(_useState,2),order=_useState2[0],setOrder=_useState2[1];var _useForm=useForm(null),form=_useForm.form,handleChange=_useForm.handleChange,setForm=_useForm.setForm;var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),errors=_useState4[0],setError=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),errorMessage=_useState6[0],setErrorMessage=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),users=_useState10[0],setUsers=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),viewOnly=_useState12[0],setViewOnly=_useState12[1];var _useParams=useParams(),id=_useParams.id;var theme=useTheme();var history=useHistory();var userContext=useContext(UserContext);var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),tabValue=_useState14[0],setTabValue=_useState14[1];useEffect(function(){if(order&&!form||order&&form&&order.id!==form.id){console.log(order);setForm(order);}},[form,order,setForm]);function canBeSubmitted(){return!_.isEqual(order,form);}useEffect(function(){var getData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!(id!=='new')){_context.next=12;break;}_context.prev=2;_context.next=5;return axios.get(\"/api/admin/tasks/\".concat(id));case 5:res=_context.sent;if(res.data.status){setOrder(res.data.data.task);}else{setErrorMessage(res.data.message);setError(res.data.errors);}_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);setError(_context.t0);case 12:axios.get('/api/admin/users').then(function(res){var data=res.data.data;setUsers(data);});_context.next=18;break;case 15:_context.prev=15;_context.t1=_context[\"catch\"](0);setLoading(false);case 18:case\"end\":return _context.stop();}}},_callee,null,[[0,15],[2,9]]);}));return function getData(){return _ref.apply(this,arguments);};}();getData();// eslint-disable-next-line\n},[]);useEffect(function(){var user=userContext.user;if(user.user_type==='creative')setViewOnly(true);},[userContext]);function dataToPost(){var post=_objectSpread(_objectSpread({},form),{},{user_id:form.user.id?form.user.id:null,vendor_id:form.vendor.id?form.vendor.id:null,task_type:form.task_type.id?form.task_type.id:form.task_type,status:form.status.id?form.status.id:form.status,duration:form.duration.id?form.duration.id:form.duration});return post;}function add(){return _add.apply(this,arguments);}function _add(){_add=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);_context2.prev=1;_context2.next=4;return axios.post('/api/admin/tasks',dataToPost());case 4:res=_context2.sent;if(res.data.status){history.push('/tasks');}else{setErrorMessage(res.data.message);setError(res.data.errors);}_context2.next=12;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);setError(_context2.t0);case 12:setLoading(false);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return _add.apply(this,arguments);}function update(){return _update.apply(this,arguments);}function _update(){_update=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.put(\"/api/admin/tasks/\".concat(id),dataToPost());case 2:res=_context3.sent;if(res.data.status){history.push('/tasks');}else{setErrorMessage(res.data.message);setError(res.data.errors);}case 4:case\"end\":return _context3.stop();}}},_callee3);}));return _update.apply(this,arguments);}function onSubmit(){if(id==='new')add();else update();}function handleChipChange(value,name){var setValue;if(name==='vendor')setValue=value;else setValue=Array.isArray(value)?value.map(function(item){return{id:item.value,name:item.label};}):{id:value.value,name:value.label};setForm(_.set(_objectSpread({},form),name,setValue));}function handleChangeTab(event,value){setTabValue(value);}if(loading){return/*#__PURE__*/React.createElement(FuseLoading,null);}function promiseOptions(inputValue){console.log(inputValue);if(inputValue.length<4)return Promise.resolve([]);return axios.get('/api/admin/get-parent-list',{params:{query:inputValue}}).then(function(res){var data=res.data;return data.data.map(function(vendor){return{id:vendor.id,label:vendor.name};});});}return/*#__PURE__*/React.createElement(FusePageCarded,{classes:{toolbar:'p-0',header:'min-h-72 h-72 sm:h-136 sm:min-h-136'},header:form&&/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-1 w-full items-center justify-between\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-col items-start max-w-full\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{className:\"normal-case flex items-center sm:mb-12\",component:Link,role:\"button\",to:\"/tasks\",color:\"inherit\"},/*#__PURE__*/React.createElement(Icon,{className:\"text-20\"},theme.direction==='ltr'?'arrow_back':'arrow_forward'),/*#__PURE__*/React.createElement(\"span\",{className:\"mx-4\"},\"Task\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"flex items-center max-w-full\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-col min-w-0 mx-8 sm:mc-16\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideLeftIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{className:\"text-16 sm:text-20 truncate\"},form.task?form.task:'New Task')),/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideLeftIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{variant:\"caption\"},\"Task\")))))),contentToolbar:id!=='new'?/*#__PURE__*/React.createElement(Tabs,{value:tabValue,onChange:handleChangeTab,indicatorColor:\"primary\",textColor:\"primary\",variant:\"scrollable\",scrollButtons:\"auto\",classes:{root:'w-full h-64'}},/*#__PURE__*/React.createElement(Tab,{className:\"h-64 normal-case\",label:\"Task\"}),/*#__PURE__*/React.createElement(Tab,{className:\"h-64 normal-case\",label:\"Posts\"})):/*#__PURE__*/React.createElement(React.Fragment,null),content:form&&/*#__PURE__*/React.createElement(\"div\",{className:\"p-16 sm:p-24 max-w-2xl\"},tabValue===0&&/*#__PURE__*/React.createElement(Grid,{container:true},/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FormHelperText,{error:true},errorMessage)),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"task\",name:\"task\",onChange:handleChange,label:\"Task\",variant:\"outlined\",InputLabelProps:{shrink:true},fullWidth:true,disabled:viewOnly,value:form.task,error:errors['task'],helperText:errors['task']?errors['task'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"description\",name:\"description\",onChange:handleChange,label:\"Description\",variant:\"outlined\",InputLabelProps:{shrink:true},fullWidth:true,disabled:viewOnly,value:form.description,error:errors['description'],helperText:errors['description']?errors['description'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"no_of_tasks\",name:\"no_of_tasks\",onChange:handleChange,label:\"Total tasks\",type:\"number\",variant:\"outlined\",InputLabelProps:{shrink:true},fullWidth:true,disabled:viewOnly,value:form.no_of_tasks,error:errors['no_of_tasks'],helperText:errors['no_of_tasks']?errors['no_of_tasks'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.status.id?form.status.id:form.status,label:form.status.name?form.status.name:form.status.toUpperCase()},onChange:function onChange(value){return handleChipChange(value,'status');},textFieldProps:{label:'Status',InputLabelProps:{shrink:true},variant:'outlined'},options:[{value:'active',label:'Active'},{value:'inactive',label:'InActive'}],variant:\"fixed\",isDisabled:viewOnly,error:errors['status'],helperText:errors['status']?errors['status'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.duration.id?form.duration.id:form.duration,label:form.duration.name?form.duration.name:form.duration.toUpperCase()},onChange:function onChange(value){return handleChipChange(value,'duration');},textFieldProps:{label:'Duration',InputLabelProps:{shrink:true},variant:'outlined'},variant:\"fixed\",isDisabled:viewOnly,options:[{value:'daily',label:'Daily'},{value:'monthly',label:'Weekly'},{value:'weekly',label:'Monthly'}],error:errors['duration'],helperText:errors['duration']?errors['duration'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.vendor.id,label:form.vendor.name?form.vendor.name:form.vendor.label},onChange:function onChange(value){return handleChipChange(value,'vendor');},textFieldProps:{label:'Vendor',InputLabelProps:{shrink:true},variant:'outlined'},isDisabled:viewOnly,error:errors['vendor_id'],helperText:errors['vendor_id']?errors['vendor_id'][0]:'',required:true,variant:\"async\",defaultOptions:true,loadOptions:promiseOptions})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:form.user.id,label:form.user.name},onChange:function onChange(value){return handleChipChange(value,'user');},textFieldProps:{label:'User',InputLabelProps:{shrink:true},variant:'outlined'},isDisabled:viewOnly,options:users.map(function(city){return{value:city.id,label:city.name};}),error:errors['user_id'],helperText:errors['user_id']?errors['user_id'][0]:'',required:true,variant:\"fixed\"})),/*#__PURE__*/React.createElement(Grid,{container:true,item:true,md:12,justify:\"flex-end\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Button,{className:\"whitespace-no-wrap normal-case\",variant:\"contained\",color:\"secondary\",disabled:viewOnly||loading||!canBeSubmitted(),onClick:onSubmit},id==='new'?'Save':'Update')))),tabValue===1&&/*#__PURE__*/React.createElement(Posts,{id:id}))});}export default withStyles(styles)(TaskCreate);","map":null,"metadata":{},"sourceType":"module"}