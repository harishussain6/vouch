{"ast":null,"code":"import _toConsumableArray from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Projects\\\\live\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{withStyles,TextField,Button,Grid,LinearProgress,FormHelperText,FormControlLabel,Icon,Typography}from'@material-ui/core';import JwtService from'app/services/jwtService';import{useForm}from'@fuse/hooks';import _ from'@lodash';import FuseChipSelect from'@fuse/core/FuseChipSelect';import{CheckBox}from'@material-ui/icons';// import fileUpload from 'fuctbase64';\nimport{useHistory,useParams}from'react-router';import FusePageCarded from'@fuse/core/FusePageCarded';import FuseAnimate from'@fuse/core/FuseAnimate';import FuseLoading from'@fuse/core/FuseLoading';import{useTheme}from'@material-ui/core/styles';import{Link}from'react-router-dom';import{Voucher}from'./Voucher';var styles=function styles(){return{};};function CreateVoucher(_ref){var handleClick=_ref.handleClick;var _useForm=useForm(null),form=_useForm.form,handleChange=_useForm.handleChange,setForm=_useForm.setForm;var _useState=useState(Voucher),_useState2=_slicedToArray(_useState,2),voucher=_useState2[0],setVoucher=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),offers=_useState4[0],setOffers=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),memberships=_useState6[0],setMemberships=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),partners=_useState8[0],setPartners=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),selectLoading=_useState10[0],setSelectLoading=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),errors=_useState12[0],setError=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),errorMessage=_useState14[0],setErrorMessage=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),disabledSelect=_useState16[0],setDisabledSelect=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),loading=_useState18[0],setLoading=_useState18[1];var _useParams=useParams(),vendor_id=_useParams.vendor_id,voucher_id=_useParams.voucher_id;var axios=JwtService.getAxios();var history=useHistory();var theme=useTheme();useEffect(function(){if(voucher&&!form||voucher&&form&&voucher.id!==form.id){voucher.vendor_id=vendor_id;setForm(voucher);}// eslint-disable-next-line\n},[form,voucher,setForm]);function canBeSubmitted(){return!_.isEqual(voucher,form);}useEffect(function(){if(offers.length>0&&partners.length>0&&memberships.length>0)setSelectLoading(false);},[offers,partners,memberships]);useEffect(function(){var getData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!(voucher_id!=='new')){_context.next=13;break;}_context.prev=2;setLoading(true);_context.next=6;return axios.get(\"/api/admin/voucher/\".concat(voucher_id));case 6:res=_context.sent;if(res.data.status){setVoucher(res.data.data);setLoading(false);}else{setErrorMessage(res.data.message);setError(res.data.errors);setLoading(false);}_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](2);setError(_context.t0);case 13:axios.get('/api/admin/membership').then(function(res){var data=res.data.data;setMemberships(data.membership);});axios.get('/api/admin/offer').then(function(res){var data=res.data.data;setOffers(data.offers);});axios.get('/api/admin/partner').then(function(res){var data=res.data.data;setPartners(data.partners);});_context.next=21;break;case 18:_context.prev=18;_context.t1=_context[\"catch\"](0);setSelectLoading(false);case 21:case\"end\":return _context.stop();}}},_callee,null,[[0,18],[2,10]]);}));return function getData(){return _ref2.apply(this,arguments);};}();getData();// eslint-disable-next-line\n},[open]);function dataToPost(){var post=_objectSpread(_objectSpread({},form),{},{vendor_id:vendor_id,membership_ids:form.memberships.map(function(membership){return membership.id;}),partner_ids:form.partners.map(function(partner){return partner.id;}),offer_ids:form.offer.map(function(offer){return offer.id;}),status:form.status.id?form.status.id:form.status});delete post.partners;delete post.memberships;delete post.offer;return post;}function add(){return _add.apply(this,arguments);}function _add(){_add=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);_context2.prev=1;_context2.next=4;return axios.post('/api/admin/voucher',dataToPost());case 4:res=_context2.sent;if(res.data.status){history.push(\"/vendor/\".concat(vendor_id));}else{setErrorMessage(res.data.message);setError(res.data.errors);}_context2.next=12;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);setError(_context2.t0);case 12:setLoading(false);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return _add.apply(this,arguments);}function update(){return _update.apply(this,arguments);}function _update(){_update=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.put(\"/api/admin/voucher/\".concat(voucher_id),dataToPost());case 2:res=_context3.sent;if(res.data.status){history.push(\"/vendor/\".concat(vendor_id,\"/vouchers\"));}else{setErrorMessage(res.data.message);setError(res.data.errors);}case 4:case\"end\":return _context3.stop();}}},_callee3);}));return _update.apply(this,arguments);}function onSubmit(){if(voucher_id==='new')add();else update();}function handleChipChange(value,name){// console.log(value);\nvar setValue=Array.isArray(value)?value.map(function(item){return{id:item.value,name:item.label};}):{id:value.value,name:value.label};setForm(_.set(_objectSpread({},form),name,setValue));}function handleChipChangem(value,name){value.map(function(data){if(data.value==\"selectall\"){console.log(memberships);setForm(_.set(_objectSpread({},form),name,memberships));setDisabledSelect(true);}else{var setValue=Array.isArray(value)?value.map(function(item){return{id:item.value,name:item.label};}):{id:value.value,name:value.label};setForm(_.set(_objectSpread({},form),name,setValue));setDisabledSelect(false);}});}function handleDate(date){return date.replace(' 00:00:00','');}if(loading){return/*#__PURE__*/React.createElement(FuseLoading,null);}return/*#__PURE__*/React.createElement(FusePageCarded,{classes:{toolbar:'p-0',header:'min-h-72 h-72 sm:h-136 sm:min-h-136'},header:form&&/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-1 w-full items-center justify-between\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-col items-start max-w-full\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{className:\"normal-case flex items-center sm:mb-12\",component:Link,role:\"button\",to:\"/vendor/\".concat(vendor_id),color:\"inherit\"},/*#__PURE__*/React.createElement(Icon,{className:\"text-20\"},theme.direction==='ltr'?'arrow_back':'arrow_forward'),/*#__PURE__*/React.createElement(\"span\",{className:\"mx-4\"},\"Voucher\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"flex items-center max-w-full\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex flex-col min-w-0 mx-8 sm:mc-16\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideLeftIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{className:\"text-16 sm:text-20 truncate\"},form.name?form.name:'New Slide')),/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideLeftIn\",delay:300},/*#__PURE__*/React.createElement(Typography,{variant:\"caption\"},\"Voucher\")))))),content:form&&/*#__PURE__*/React.createElement(Grid,{container:true,className:\"p-16 sm:p-24 max-w-2xl\"},/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FormHelperText,{error:true},errorMessage)),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{autoFocus:true,margin:\"dense\",className:\"mt-8 mb-8\",id:\"name\",name:\"name\",label:\"Name\",type:\"text\",fullWidth:true,value:form.name,onChange:handleChange,variant:\"outlined\",error:errors['name']?true:false,helperText:errors['name']?errors['name'][0]:null})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{autoFocus:true,className:\"mt-8 mb-8\",margin:\"dense\",id:\"description\",name:\"description\",label:\"Description\",type:\"text\",fullWidth:true,value:form.description,onChange:handleChange,variant:\"outlined\",error:errors['description']?true:false,helperText:errors['description']?errors['description'][0]:null})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",autoFocus:true,margin:\"dense\",id:\"savings\",name:\"savings\",label:\"Savings\",type:\"text\",fullWidth:true,value:form.savings,onChange:handleChange,variant:\"outlined\",error:errors['savings']?true:false,helperText:errors['savings']?errors['savings'][0]:null})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",autoFocus:true,margin:\"dense\",id:\"vc_code\",name:\"vc_code\",label:\"VC Code\",type:\"text\",fullWidth:true,value:form.vc_code,onChange:handleChange,variant:\"outlined\",error:errors['vc_code']?true:false,helperText:errors['vc_code']?errors['vc_code'][0]:null})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",autoFocus:true,margin:\"dense\",id:\"pos_code\",name:\"pos_code\",label:\"VC Code\",type:\"text\",fullWidth:true,value:form.pos_code,onChange:handleChange,variant:\"outlined\",error:errors['pos_code']?true:false,helperText:errors['pos_code']?errors['pos_code'][0]:null})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{id:\"act_date\",className:\"mt-8 mb-8\",name:\"act_date\",onChange:handleChange,label:\"Activation Date\",type:\"date\",value:handleDate(form.act_date),variant:\"outlined\",fullWidth:true,error:errors['act_date'],helperText:errors['act_date']?errors['act_date'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{id:\"exp_date\",className:\"mt-8 mb-8\",name:\"exp_date\",onChange:handleChange,label:\"Expiration Date\",type:\"date\",value:handleDate(form.exp_date),variant:\"outlined\",fullWidth:true,error:errors['exp_date'],helperText:errors['exp_date']?errors['exp_date'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{className:\"mt-8 mb-8\",id:\"valid_to\",name:\"valid_to\",onChange:handleChange,label:\"Valid to\",type:\"time\",value:form.valid_to,variant:\"outlined\",fullWidth:true,error:errors['valid_to'],helperText:errors['valid_to']?errors['valid_to'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(TextField,{id:\"valid_from\",name:\"valid_from\",onChange:handleChange,label:\"Expiration Date\",type:\"time\",value:form.valid_from,variant:\"outlined\",fullWidth:true,error:errors['valid_from'],helperText:errors['valid_from']?errors['valid_from'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FormControlLabel,{className:\"ml-4 mt-8 mb-24\",control:/*#__PURE__*/React.createElement(CheckBox,{checked:form.redeem,onChange:handleChange,name:\"redeem\",color:\"primary\"}),label:\"Redeem\"})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FormControlLabel,{className:\"ml-4 mt-8 mb-24\",control:/*#__PURE__*/React.createElement(CheckBox,{checked:form.is_percent,onChange:handleChange,name:\"is_percent\",color:\"primary\"}),label:\"Is Percent?\"})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:{value:typeof form.status!=='object'?form.status:form.status.id,label:typeof form.status!=='object'?form.status.toUpperCase():form.status.name},onChange:function onChange(value){return handleChipChange(value,'status');},textFieldProps:{label:'Status',InputLabelProps:{shrink:true},variant:'outlined'},options:[{value:'active',label:'Active'},{value:'inactive',label:'InActive'}],error:errors['status'],helperText:errors['status']?errors['status'][0]:''})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},selectLoading?/*#__PURE__*/React.createElement(LinearProgress,null):/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\"// value={selectedOptions}\n,value:form.memberships.map(function(membership){return{value:membership.id,label:membership.name};}),onChange:function onChange(value){return handleChipChangem(value,'memberships');},placeholder:\"Select multiple memberships\",textFieldProps:{label:'Memberships',InputLabelProps:{shrink:true},variant:'outlined'},isMulti:true,options:[disabledSelect==false?{value:'selectall',label:'Select All'}:''].concat(_toConsumableArray(memberships.map(function(membership){return{value:membership.id,label:membership.name};})))// options={filteredOptions}\n,error:errors['membership_ids'],helperText:errors['membership_ids']?errors['membership_ids'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},selectLoading?/*#__PURE__*/React.createElement(LinearProgress,null):/*#__PURE__*/React.createElement(FuseChipSelect,{isDisabled:true,className:\"mt-8 mb-8\",value:form.partners.map(function(partner){return{value:partner.id,label:partner.name};}),onChange:function onChange(value){return handleChipChange(value,'partners');},placeholder:\"Select multiple partners\",textFieldProps:{label:'Partners',InputLabelProps:{shrink:true},variant:'outlined'},isMulti:true,options:partners.map(function(partner){return{value:partner.id,label:partner.name};}),error:errors['partner_ids'],helperText:errors['partner_ids']?errors['partner_ids'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{item:true,md:12},selectLoading?/*#__PURE__*/React.createElement(LinearProgress,null):/*#__PURE__*/React.createElement(FuseChipSelect,{className:\"mt-8 mb-8\",value:form.offer.map(function(offer){return{value:offer.id,label:offer.name};}),onChange:function onChange(value){return handleChipChange(value,'offer');},placeholder:\"Select multiple Offers\",textFieldProps:{label:'Offers',InputLabelProps:{shrink:true},variant:'outlined'},isMulti:true,options:offers.map(function(offer){return{value:offer.id,label:offer.name};}),error:errors['offers'],helperText:errors['offers']?errors['offers'][0]:'',required:true})),/*#__PURE__*/React.createElement(Grid,{container:true,item:true,md:12,justify:\"flex-end\"},/*#__PURE__*/React.createElement(FuseAnimate,{animation:\"transition.slideRightIn\",delay:300},/*#__PURE__*/React.createElement(Button,{className:\"whitespace-no-wrap normal-case\",variant:\"contained\",color:\"secondary\",disabled:loading||!canBeSubmitted(),onClick:onSubmit},voucher_id==='new'?'Save':'Update'))))});}export default withStyles(styles)(CreateVoucher);","map":null,"metadata":{},"sourceType":"module"}